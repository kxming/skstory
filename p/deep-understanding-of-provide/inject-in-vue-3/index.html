<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="provide and inject are primarily offered for use cases in high-order plugins/component libraries. It‚Äôs not recommended for direct use in application code."><title>Deep Understanding of Provide/Inject in Vue 3</title>
<link rel=canonical href=https://www.skstory.online/p/deep-understanding-of-provide/inject-in-vue-3/><link rel=stylesheet href=/scss/style.min.663803bebe609202d5b39d848f2d7c2dc8b598a2d879efa079fa88893d29c49c.css><meta property='og:title' content="Deep Understanding of Provide/Inject in Vue 3"><meta property='og:description' content="provide and inject are primarily offered for use cases in high-order plugins/component libraries. It‚Äôs not recommended for direct use in application code."><meta property='og:url' content='https://www.skstory.online/p/deep-understanding-of-provide/inject-in-vue-3/'><meta property='og:site_name' content='SK Story'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='Code'><meta property='article:tag' content='Javascript'><meta property='article:published_time' content='2024-06-12T16:02:05+08:00'><meta property='article:modified_time' content='2024-06-12T16:02:05+08:00'><meta property='og:image' content='https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lYfmoRGWanDnm0jzf-3rKQ.png'><meta name=twitter:site content="@https://twitter.com/ShawnKxming"><meta name=twitter:creator content="@https://twitter.com/ShawnKxming"><meta name=twitter:title content="Deep Understanding of Provide/Inject in Vue 3"><meta name=twitter:description content="provide and inject are primarily offered for use cases in high-order plugins/component libraries. It‚Äôs not recommended for direct use in application code."><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content='https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lYfmoRGWanDnm0jzf-3rKQ.png'><link rel="shortcut icon" href=/favicon.ico></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu1157332405703967761.jpeg width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>üç•</span></figure><div class=site-meta><h1 class=site-name><a href=/>SK Story</a></h1><h2 class=site-description>Shawn King's Stories Website</h2></div></header><ol class=menu-social><li><a href=mailto:kxming0229@gmail.com target=_blank title=Email rel=me><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-mail"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 7a2 2 0 012-2h14a2 2 0 012 2v10a2 2 0 01-2 2H5a2 2 0 01-2-2V7z"/><path d="M3 7l9 6 9-6"/></svg></a></li><li><a href=https://www.facebook.com/p/King-Shawn-100092679065959/ target=_blank title=Facebook rel=me><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-facebook"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 10v4h3v7h4v-7h3l1-4h-4V8a1 1 0 011-1h3V3h-3a5 5 0 00-5 5v2H7"/></svg></a></li><li><a href=https://twitter.com/ShawnKxming target=_blank title=Twitter rel=me><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-x"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 4l11.733 16H20L8.267 4z"/><path d="M4 20l6.768-6.768m2.46-2.46L20 4"/></svg></a></li><li><a href=https://t.me/shawnkxming target=_blank title=Telegram rel=me><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-telegram"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M15 10l-4 4 6 6 4-16-18 7 4 2 2 6 3-4"/></svg></a></li><li><a href=https://medium.com/@kxming target=_blank title=Medium rel=me><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-medium"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 4m0 2a2 2 0 012-2h12a2 2 0 012 2v12a2 2 0 01-2 2H6a2 2 0 01-2-2z"/><path d="M8 9h1l3 3 3-3h1"/><path d="M8 15h2"/><path d="M14 15h2"/><path d="M9 9v6"/><path d="M15 9v6"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li><a href=/links/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>Links</span></a></li><li><a href=/about/><svg class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg>
<span>About</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#introduction>Introduction</a></li><li><a href=#usage>Usage</a></li><li><a href=#what-problem-does-provideinject-solve>What problem does Provide/Inject solve?</a></li><li><a href=#name-conflict>Name Conflict</a><ol><li><a href=#solution>Solution</a></li></ol></li><li><a href=#injection-note>Injection Note</a><ol><li><a href=#solution-1>Solution</a></li></ol></li><li><a href=#strict-injection>Strict Injection</a><ol><li><a href=#solution-2>Solution</a></li></ol></li><li><a href=#cascaded-penetration>Cascaded Penetration</a><ol><li><a href=#solution-3>Solution</a></li></ol></li><li><a href=#summary>Summary:</a></li></ol></nav></div></section></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/p/deep-understanding-of-provide/inject-in-vue-3/><img src=https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lYfmoRGWanDnm0jzf-3rKQ.png loading=lazy alt="Featured image of post Deep Understanding of Provide/Inject in Vue 3"></a></div><div class=article-details><header class=article-category><a href=/categories/code/>Code
</a><a href=/categories/javascript/ style=background-color:#d1d419;color:#fff>Javascript</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/deep-understanding-of-provide/inject-in-vue-3/>Deep Understanding of Provide/Inject in Vue 3</a></h2><h3 class=article-subtitle>provide and inject are primarily offered for use cases in high-order plugins/component libraries. It‚Äôs not recommended for direct use in application code.</h3></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Jun 12, 2024</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>10 minute read</time></div></footer></div></header><section class=article-content><h2 id=introduction>Introduction</h2><p><code>provide</code> and <code>inject</code> are primarily offered for use cases in high-order plugins/component libraries. It‚Äôs not recommended for direct use in application code.</p><ul><li><p><strong>Definition explanation</strong>: These options are used together to allow an ancestor component to inject a dependency into all of its descendants, regardless of the depth of the component hierarchy, and to be effective for the duration of their parent-child relationship.</p></li><li><p><strong>In simpler terms</strong>: If the component hierarchy is too complex, and our descendant components want to access resources from an ancestor component, what should we do? It‚Äôs not practical to keep reaching up to the parent level, as this can make the code structure confusing. This is where these options come into play.</p><ul><li><p><code>provide</code>: Is an object, or a function that returns an object. It contains things to be given to the descendants, that is, properties and property values.</p></li><li><p><code>inject</code>: Is an array of strings, or an object. The property value can be an object, containing a ‚Äòfrom‚Äô field and a default value.</p></li></ul></li></ul><p>In a nutshell: <code>provide</code> can offer data and methods to modify it to all descendant components, which use <code>inject</code> to access the data.</p><h2 id=usage>Usage</h2><p><code>Parent.vue</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&lt;template&gt;
</span></span><span class=line><span class=cl>  &lt;div&gt;
</span></span><span class=line><span class=cl>    &lt;son /&gt;
</span></span><span class=line><span class=cl>  &lt;/div&gt;
</span></span><span class=line><span class=cl>&lt;/template&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&lt;script setup&gt;
</span></span><span class=line><span class=cl>import son from &#34;./son.vue&#34;;
</span></span><span class=line><span class=cl>import { provide } from &#34;vue&#34;;
</span></span><span class=line><span class=cl>provide(&#34;abc&#34;, &#34;123&#34;);
</span></span><span class=line><span class=cl>&lt;/script&gt;
</span></span></code></pre></td></tr></table></div></div><p><code>Child.vue</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&lt;template&gt;
</span></span><span class=line><span class=cl>  &lt;div&gt;
</span></span><span class=line><span class=cl>    &lt;grandson /&gt;
</span></span><span class=line><span class=cl>  &lt;/div&gt;
</span></span><span class=line><span class=cl>&lt;/template&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&lt;script setup&gt;
</span></span><span class=line><span class=cl>import grandson from &#34;./DeepChild.vue&#34;;
</span></span><span class=line><span class=cl>&lt;/script&gt;
</span></span></code></pre></td></tr></table></div></div><p><code>DeepChild.vue</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=o>&lt;</span><span class=n>template</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=o>&lt;</span><span class=n>div</span><span class=o>&gt;</span><span class=n>DeepChild</span><span class=o>&lt;/</span><span class=n>div</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=o>&lt;/</span><span class=n>template</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>&lt;</span><span class=n>script</span> <span class=n>setup</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=n>import</span> <span class=p>{</span> <span class=n>inject</span> <span class=p>}</span> <span class=n>from</span> <span class=s2>&#34;vue&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>const</span> <span class=n>abc</span> <span class=o>=</span> <span class=n>inject</span><span class=p>(</span><span class=s2>&#34;abc&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>console</span><span class=o>.</span><span class=n>log</span><span class=p>(</span><span class=n>abc</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=o>&lt;/</span><span class=n>script</span><span class=o>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>Note:</strong></p><blockquote><p>inject() can only be used inside setup() or functional components.</p></blockquote><p>Since adopting the organization method of <code>Provide/Inject</code>, the flexibility of the code organization has significantly increased. However, this rise in flexibility is accompanied by a decrease in code fault tolerance. I believe that those who have truly incorporated <code>Provide/Inject</code> into their projects must have encountered or are currently experiencing the following situations:</p><ul><li><p>Often misspelling the injection key, or finding it difficult to name the injection key due to having too many (a common issue among programmers).</p></li><li><p>In order to understand what is injected by <code>inject()</code>, one has to find the corresponding provide().</p></li><li><p>Another scenario is repeatedly <code>provide()</code>ing the same value, leading to Injection override.</p></li><li><p>When using <code>inject()</code>, there may not necessarily be a corresponding <code>provide()</code> up the ancestor chain, making it necessary to handle null values or provide default values.</p></li><li><p>Using <code>provide()</code> within a hook, but components calling this hook cannot <code>inject()</code> the provided value from this hook.</p></li></ul><p>‚Ä¶</p><h2 id=what-problem-does-provideinject-solve>What problem does Provide/Inject solve?</h2><p>Dependency Injection | It is mentioned in Vue.js that the main purpose of these two APIs, Provide and Inject, is to solve the issue of prop drilling (as shown below).</p><p><img src=https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Yk3pVzaCllDs0pw9yKaBmg.png loading=lazy></p><p>After introducing Provide/Inject, Props can be directly passed to descendant components (as shown below).</p><p><img src=https://miro.medium.com/v2/resize:fit:1400/format:webp/1*--koHxOmrxxQ-aIiB5NQPQ.png loading=lazy></p><p>In the root component, the injection value is provided using provide. Here is an example code:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>import { provide } from &#39;vue&#39;;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>provide(/* Injection name */ &#39;account&#39;, /* Value */ { name: &#39;youth&#39; });
</span></span></code></pre></td></tr></table></div></div><p>In descendant components, the value injected by ancestor components is obtained through inject. Here is an example code:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>import</span> <span class=p>{</span> <span class=n>inject</span> <span class=p>}</span> <span class=n>from</span> <span class=s1>&#39;vue&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>const</span> <span class=n>message</span> <span class=o>=</span> <span class=n>inject</span><span class=p>(</span><span class=s1>&#39;account&#39;</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=name-conflict>Name Conflict</h2><p>The issue is how to ensure that <code>account</code> isn‚Äôt overwritten by other business components? For example, if some business component also supplies information for <code>account</code>, as shown below:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>// Main.vue
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl>provide(&#39;account&#39;, {...})
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>// ParentView.vue
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl>provide(&#39;account&#39;, {...})
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>// DeepChild.vue
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl>inject(&#39;account&#39;)
</span></span><span class=line><span class=cl>...
</span></span></code></pre></td></tr></table></div></div><p>The <code>ParentView</code> component in the middle layer might be a user list component, which also provides account data. Here, the <code>account</code> could be the user selected from the list, whereas the account provided in Main is the current user. In the <code>DeepChild</code> component, there might be a need for both the current logged-in user information and the selected user information from the list. However, as it stands, <code>DeepChild</code> can only access the selected user information provided by <code>ParentView</code>.</p><p>Of course, there are many solutions to this business scenario, but let‚Äôs assume for now it can only be solved using <code>provide/inject</code>.</p><p>Certainly, we can simply rename the injection name to <code>selectAccount</code> in <code>ParentView</code> to solve this problem. But what if there are other components in the middle layer that also have <code>selectAccount</code>?</p><h3 id=solution>Solution</h3><p>Create a file named <code>injection-key.ts</code> in the project. I prefer to create this file as <code>src/constants/injection-key.ts</code>. This way, the injection names under the project are managed uniformly in this file, and Symbols are used to create injection names, to avoid naming conflicts.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=k>export</span> <span class=k>const</span> <span class=n>CurAccountKey</span> <span class=o>=</span> <span class=n>Symbol</span><span class=p>(</span><span class=s1>&#39;account&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>export</span> <span class=k>const</span> <span class=n>AuthAccountKey</span> <span class=o>=</span> <span class=n>Symbol</span><span class=p>(</span><span class=s1>&#39;account&#39;</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><p>Example of usage:</p><p><code>Main.vue</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>import</span> <span class=p>{</span> <span class=n>provide</span> <span class=p>}</span> <span class=n>from</span> <span class=s1>&#39;vue&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>import</span> <span class=p>{</span> <span class=n>CurAccountKey</span> <span class=p>}</span> <span class=n>from</span> <span class=s1>&#39;@/constants/injectionKeys&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>const</span> <span class=n>user</span> <span class=o>=</span> <span class=n>reactive</span><span class=p>({</span> <span class=n>id</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span> <span class=n>name</span><span class=p>:</span> <span class=s1>&#39;youth&#39;</span> <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=n>provide</span><span class=p>(</span><span class=n>CurAccountKey</span><span class=p>,</span> <span class=n>user</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><p><code>ParentView.vue</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>import</span> <span class=p>{</span> <span class=n>provide</span> <span class=p>}</span> <span class=n>from</span> <span class=s1>&#39;vue&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>import</span> <span class=p>{</span> <span class=n>AuthAccountKey</span> <span class=p>}</span> <span class=n>from</span> <span class=s1>&#39;@/constants/injectionKeys&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>const</span> <span class=n>user</span> <span class=o>=</span> <span class=n>reactive</span><span class=p>({</span> <span class=n>id</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span> <span class=n>name</span><span class=p>:</span> <span class=s1>&#39;John Doe&#39;</span> <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=n>provide</span><span class=p>(</span><span class=n>AuthAccountKey</span><span class=p>,</span> <span class=n>user</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><p><code>DeepChild.vue</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>import</span> <span class=p>{</span> <span class=n>inject</span> <span class=p>}</span> <span class=n>from</span> <span class=s1>&#39;vue&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>import</span> <span class=p>{</span> <span class=n>AuthAccountKey</span><span class=p>,</span> <span class=n>CurAccountKey</span> <span class=p>}</span> <span class=n>from</span> <span class=s1>&#39;@/constants/injectionKeys&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>const</span> <span class=n>curAccount</span> <span class=o>=</span> <span class=n>inject</span><span class=p>(</span><span class=n>CurAccountKey</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>const</span> <span class=n>authAccount</span> <span class=o>=</span> <span class=n>inject</span><span class=p>(</span><span class=n>AuthAccountKey</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=injection-note>Injection Note</h2><p>But what kind of data will using <code>inject(CurAccountKey)</code> bring? This requires a global search for where <code>CurAccountKey</code> is provided. This is not a good user experience, and this is when the official Vue documentation recommends using TS.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>import</span> <span class=p>{</span> <span class=n>inject</span> <span class=p>}</span> <span class=n>from</span> <span class=s1>&#39;vue&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>import</span> <span class=p>{</span> <span class=n>AuthAccountKey</span><span class=p>,</span> <span class=n>CurAccountKey</span> <span class=p>}</span> <span class=n>from</span> <span class=s1>&#39;@/constants/injectionKeys&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>const</span> <span class=n>curAccount</span> <span class=o>=</span> <span class=n>inject</span><span class=p>(</span><span class=n>CurAccountKey</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>curAccount</span><span class=o>.</span><span class=n>name</span><span class=p>;</span> <span class=o>//</span> <span class=n>Does</span> <span class=n>curAccount</span> <span class=n>have</span> <span class=n>a</span> <span class=n>name</span><span class=err>?</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=solution-1>Solution</h3><p>Using TS and InjectionKey can effectively solve the type hinting issue.</p><p><code>src/types.ts</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=k>export</span> <span class=n>interface</span> <span class=n>Account</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>name</span><span class=p>:</span> <span class=n>string</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>id</span><span class=p>:</span> <span class=n>number</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></td></tr></table></div></div><p><code>src/constants/injection-key.ts</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>import</span> <span class=p>{</span> <span class=n>InjectionKey</span> <span class=p>}</span> <span class=n>from</span> <span class=s1>&#39;vue&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>import</span> <span class=p>{</span> <span class=n>Account</span> <span class=p>}</span> <span class=n>from</span> <span class=s1>&#39;@/types&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>export</span> <span class=k>const</span> <span class=n>CurAccountKey</span><span class=p>:</span> <span class=n>InjectionKey</span><span class=o>&lt;</span><span class=n>Account</span><span class=o>&gt;</span> <span class=o>=</span> <span class=n>Symbol</span><span class=p>(</span><span class=s1>&#39;account&#39;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p><code>Main.vue</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>import</span> <span class=p>{</span> <span class=n>provide</span> <span class=p>}</span> <span class=n>from</span> <span class=s1>&#39;vue&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>import</span> <span class=p>{</span> <span class=n>CurAccountKey</span> <span class=p>}</span> <span class=n>from</span> <span class=s1>&#39;@/constants/injectionKeys&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>const</span> <span class=n>user</span> <span class=o>=</span> <span class=n>reactive</span><span class=p>({</span> <span class=n>id</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span> <span class=n>name</span><span class=p>:</span> <span class=s1>&#39;youth&#39;</span> <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=n>provide</span><span class=p>(</span><span class=n>CurAccountKey</span><span class=p>,</span> <span class=s1>&#39;name: youth&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>provide</span><span class=p>(</span><span class=n>CurAccountKey</span><span class=p>,</span> <span class=n>user</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><p><code>DeepChild.vue</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=k>const</span> <span class=n>curAccount</span> <span class=o>=</span> <span class=n>inject</span><span class=p>(</span><span class=n>CurAccountKey</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>curAccount</span><span class=err>?</span><span class=o>.</span><span class=n>age</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>curAccount</span><span class=err>?</span><span class=o>.</span><span class=n>id</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=strict-injection>Strict Injection</h2><p>By default, <code>inject</code> assumes that the injection name passed in will be provided by some ancestor component in the chain. If indeed no component provides that injection name, it will throw a runtime warning.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=k>const</span> <span class=n>curAccount</span> <span class=o>=</span> <span class=n>inject</span><span class=p>(</span><span class=n>CurAccountKey</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>curAccount</span><span class=err>?</span><span class=o>.</span><span class=n>id</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><p>Of course, sometimes we may not require the ancestor chain to provide it. In this case, the official Vue documentation recommends using a default value to solve the situation where the ancestor chain does not provide a value, which only solves the situation where the inject value is not essential.</p><p>However, in some cases, we do require the ancestor chain to provide the necessary inject, which is more common in the development of generic components. For example: the <code>&lt;ElTable></code> and <code>&lt;ElTableColumn></code> components, <code>&lt;ElTableColumn></code> must have an <code>&lt;ElTable></code> component in its ancestor chain. It is illegal to use <code>&lt;ElTableColumn></code> alone, and an error ‚ùå should be thrown instead of a warning ‚ö†Ô∏è.</p><p>To solve the above strict dependency issue, of course, we can judge in the child component whether the value of inject is undefined and throw an exception if it is. This code is simple:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=k>const</span> <span class=n>curAccount</span> <span class=o>=</span> <span class=n>inject</span><span class=p>(</span><span class=n>CurAccountKey</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=n>curAccount</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>throw</span> <span class=n>new</span> <span class=n>Error</span><span class=p>(</span><span class=s1>&#39;CurAccountKey must have a corresponding Provide&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>curAccount</span><span class=o>.</span><span class=n>id</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><p>Yes, not bad! It solves the problem! What if there are many strict dependencies? Would we have to use if statements everywhere?</p><h3 id=solution-2>Solution</h3><p>Create a strict injection utility function that throws an exception when the corresponding injection name is not provided.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=k>export</span> <span class=k>const</span> <span class=n>injectStrict</span> <span class=o>=</span> <span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=p>(</span><span class=n>key</span><span class=p>:</span> <span class=n>InjectionKey</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=p>,</span> <span class=n>defaultValue</span><span class=err>?</span><span class=p>:</span> <span class=n>T</span> <span class=o>|</span> <span class=p>(()</span> <span class=o>=&gt;</span> <span class=n>T</span><span class=p>),</span> <span class=n>treatDefaultAsFactory</span><span class=err>?</span><span class=p>:</span> <span class=bp>false</span><span class=p>):</span> <span class=n>T</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>const</span> <span class=n>result</span> <span class=o>=</span> <span class=n>inject</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>defaultValue</span><span class=p>,</span> <span class=n>treatDefaultAsFactory</span><span class=p>);</span> 
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=n>result</span><span class=p>)</span> <span class=p>{</span> 
</span></span><span class=line><span class=cl>    <span class=n>throw</span> <span class=n>new</span> <span class=n>Error</span><span class=p>(</span><span class=err>`</span><span class=n>Could</span> <span class=ow>not</span> <span class=n>resolve</span> <span class=o>$</span><span class=p>{</span><span class=n>key</span><span class=o>.</span><span class=n>description</span><span class=p>}</span><span class=err>`</span><span class=p>);</span> 
</span></span><span class=line><span class=cl>  <span class=p>}</span> 
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>result</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>Rewrite it using injectStrict:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=k>const</span> <span class=n>curAccount</span> <span class=o>=</span> <span class=n>injectStrict</span><span class=p>(</span><span class=n>CurAccountKey</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>curAccount</span><span class=o>.</span><span class=n>id</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=cascaded-penetration>Cascaded Penetration</h2><p>In Vue, the Provide component cannot use the provided value.</p><p>This might seem a bit confusing, but in practical terms, the usage is like this:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=k>const</span> <span class=n>user</span> <span class=o>=</span> <span class=n>reactive</span><span class=p>({</span> <span class=n>id</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span> <span class=n>name</span><span class=p>:</span> <span class=s1>&#39;youth&#39;</span> <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=n>provide</span><span class=p>(</span><span class=n>CurAccountKey</span><span class=p>,</span> <span class=n>user</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=o>...</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>inject</span><span class=p>(</span><span class=n>CurAccount</span><span class=p>);</span> <span class=o>//</span> <span class=n>Here</span> <span class=n>it</span><span class=s1>&#39;s impossible to obtain the user provided above.</span>
</span></span></code></pre></td></tr></table></div></div><p>Huh? At this point, some might question, using the provide value in the Provide component? Is that a mistake? How could there be such an operation?</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=k>const</span> <span class=n>user</span> <span class=o>=</span> <span class=n>reactive</span><span class=p>({</span> <span class=n>id</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span> <span class=n>name</span><span class=p>:</span> <span class=s1>&#39;youth&#39;</span> <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=n>provide</span><span class=p>(</span><span class=n>CurAccountKey</span><span class=p>,</span> <span class=n>user</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>//</span> <span class=n>When</span> <span class=n>the</span> <span class=n>value</span> <span class=n>of</span> <span class=n>user</span> <span class=n>is</span> <span class=n>needed</span> <span class=n>here</span><span class=p>,</span> <span class=n>why</span> <span class=ow>not</span> <span class=n>use</span> <span class=n>it</span> <span class=n>directly</span><span class=err>??</span>
</span></span><span class=line><span class=cl><span class=n>user</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><p>The issue of cascaded transmission comes up again.</p><p>But, don‚Äôt forget the scenario with custom hooks!! What if <code>provide(CurAccountKey, user)</code>, is inside a custom hook?</p><p><code>useAccount.ts</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=k>export</span> <span class=k>const</span> <span class=n>useAccount</span> <span class=o>=</span> <span class=n>async</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>const</span> <span class=n>user</span> <span class=o>=</span> <span class=n>await</span> <span class=n>fetch</span><span class=p>(</span><span class=s1>&#39;/**/*&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>provide</span><span class=p>(</span><span class=n>CurAccountKey</span><span class=p>,</span> <span class=n>user</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=p>{</span> <span class=n>user</span> <span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>If it‚Äôs a direct call to <code>useAccount</code> then it‚Äôs not an issue, because <code>useAccount</code> returns user. It is very intuitive and convenient to directly destructure <code>user</code> at the place where <code>useAccount</code> is called.</p><p>What if <code>useAccount</code> is encapsulated by another hook?</p><p><code>useApp.ts</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=k>export</span> <span class=k>const</span> <span class=n>useApp</span> <span class=o>=</span> <span class=n>async</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>const</span> <span class=n>account</span> <span class=o>=</span> <span class=n>await</span> <span class=n>useAccount</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=o>...</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>account</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>Of course, this isn‚Äôt without a solution, you can destructure account in <code>useApp</code> and then return it.</p><p><code>useApp.ts</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=k>export</span> <span class=k>const</span> <span class=n>useApp</span> <span class=o>=</span> <span class=n>async</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>const</span> <span class=n>account</span> <span class=o>=</span> <span class=n>await</span> <span class=n>useAccount</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=o>...</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=o>...</span><span class=n>account</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>STOP!!!</strong></p><p>Do you find this situation familiar? If we replace the hook with a component, wouldn‚Äôt the situation be just like this:</p><p><img src=https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Yk3pVzaCllDs0pw9yKaBmg.png loading=lazy></p><p>You can‚Äôt just say it‚Äôs similar, it‚Äôs exactly the same! The emergence of <code>Provide/Inject</code> was to solve such issues, but when transparency occurs in hooks, it becomes just like the original problem again!</p><h3 id=solution-3>Solution</h3><p>The solution to the above problem is quite simple, which is to obtain the current component instance, and then find the provided value from the component instance!</p><p>Since Vue itself does not support the current component obtaining the provide of the current component, let‚Äôs implement one ourselves!</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>import</span> <span class=p>{</span> <span class=n>getCurrentInstance</span><span class=p>,</span> <span class=n>inject</span><span class=p>,</span> <span class=n>InjectionKey</span> <span class=p>}</span> <span class=n>from</span> <span class=s1>&#39;vue&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>export</span> <span class=k>const</span> <span class=n>injectWithSelf</span> <span class=o>=</span> <span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=p>(</span> <span class=n>key</span><span class=p>:</span> <span class=n>InjectionKey</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=p>):</span> <span class=n>T</span> <span class=o>|</span> <span class=n>undefined</span> <span class=o>=&gt;</span> <span class=p>{</span> 
</span></span><span class=line><span class=cl>  <span class=k>const</span> <span class=n>vm</span> <span class=o>=</span> <span class=n>getCurrentInstance</span><span class=p>()</span> <span class=n>as</span> <span class=n>any</span><span class=p>;</span> 
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>vm</span><span class=err>?</span><span class=o>.</span><span class=n>provides</span><span class=p>[</span><span class=n>key</span> <span class=n>as</span> <span class=n>any</span><span class=p>]</span> <span class=o>||</span> <span class=n>inject</span><span class=p>(</span><span class=n>key</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>Here, we find the provide value with the corresponding key from the current component‚Äôs instance. If it doesn‚Äôt exist, we use inject to get it from the ancestor chain components.</p><p>Let‚Äôs rewrite it using injectWithSelf:</p><p><code>useAccount.ts</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=k>export</span> <span class=k>const</span> <span class=n>useAccount</span> <span class=o>=</span> <span class=n>async</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>const</span> <span class=n>user</span> <span class=o>=</span> <span class=n>await</span> <span class=n>fetch</span><span class=p>(</span><span class=s1>&#39;/**/*&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>provide</span><span class=p>(</span><span class=n>CurAccountKey</span><span class=p>,</span> <span class=n>user</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=p>{</span> <span class=n>user</span> <span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p><code>useApp.ts</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=k>export</span> <span class=k>const</span> <span class=n>useApp</span> <span class=o>=</span> <span class=n>async</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>const</span> <span class=n>account</span> <span class=o>=</span> <span class=n>await</span> <span class=n>useAccount</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=o>...</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>account</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p><code>Main.vue</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>useApp</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>//</span> <span class=n>It</span> <span class=n>must</span> <span class=n>be</span> <span class=n>after</span> <span class=n>useApp</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=k>const</span> <span class=n>user</span> <span class=o>=</span> <span class=n>injectWithSelf</span><span class=p>(</span><span class=n>CurAccountKey</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=summary>Summary:</h2><ul><li><p>Use Symbol to create injection names to avoid naming conflicts.</p></li><li><p>Using TS and InjectionKey can effectively solve type hinting issues.</p></li><li><p>Using custom injectStrict can solve strict injection problems.</p></li><li><p>Using custom injectWithSelf can solve the issue of return values penetrating through levels when hooks are nested.</p></li></ul></section><footer class=article-footer><section class=article-tags><a href=/tags/code/>Code</a>
<a href=/tags/javascript/>Javascript</a></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article class=has-image><a href=/p/advanced-usage-of-reduce-you-might-not-know/><div class=article-image><img src=https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h7QTz6KqyeYG_ausGQjj5g.jpeg loading=lazy data-key data-hash=https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h7QTz6KqyeYG_ausGQjj5g.jpeg></div><div class=article-details><h2 class=article-title>Advanced Usage of Reduce You Might Not Know</h2></div></a></article><article class=has-image><a href=/p/vue3-performance-optimization-code-level-optimization/><div class=article-image><img src=https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KZsES-HkGUvu6TkmfmNMBA.png loading=lazy data-key data-hash=https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KZsES-HkGUvu6TkmfmNMBA.png></div><div class=article-details><h2 class=article-title>Vue3 Performance Optimization ‚Äî Code-Level Optimization</h2></div></a></article><article class=has-image><a href=/p/vue3-performance-optimization-bundle-optimization/><div class=article-image><img src=https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KZsES-HkGUvu6TkmfmNMBA.png loading=lazy data-key data-hash=https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KZsES-HkGUvu6TkmfmNMBA.png></div><div class=article-details><h2 class=article-title>Vue3 Performance Optimization ‚Äî Bundle Optimization</h2></div></a></article><article class=has-image><a href=/p/how-much-do-you-know-about-29-javascript-object-methods/><div class=article-image><img src=https://miro.medium.com/v2/resize:fit:1400/format:webp/1*l_w8hkehf25Nx3H_AzEVbQ.jpeg loading=lazy data-key data-hash=https://miro.medium.com/v2/resize:fit:1400/format:webp/1*l_w8hkehf25Nx3H_AzEVbQ.jpeg></div><div class=article-details><h2 class=article-title>How Much Do You Know About 29 JavaScript Object Methods?</h2></div></a></article><article class=has-image><a href=/p/most-of-the-books-youve-read-are-mostly-forgotten-so-why-keep-reading/><div class=article-image><img src=https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Zm-09l_F3UwVf2IneHGHew.jpeg loading=lazy data-key data-hash=https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Zm-09l_F3UwVf2IneHGHew.jpeg></div><div class=article-details><h2 class=article-title>Most of the books you‚Äôve read are mostly forgotten, so why keep reading?</h2></div></a></article></div></div></aside><script src=https://giscus.app/client.js data-repo=kxming/skstory data-repo-id=R_kgDOLehX4A data-category=Announcements data-category-id=DIC_kwDOLehX4M4Cd4Vx data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=light data-lang=en-us data-loading crossorigin=anonymous async></script><script>function setGiscusTheme(e){let t=document.querySelector("iframe.giscus-frame");t&&t.contentWindow.postMessage({giscus:{setConfig:{theme:e}}},"https://giscus.app")}(function(){addEventListener("message",t=>{if(event.origin!=="https://giscus.app")return;e()}),window.addEventListener("onColorSchemeChange",e);function e(){setGiscusTheme(document.documentElement.dataset.scheme==="light"?"light":"dark_dimmed")}})()</script><footer class=site-footer><section class=copyright>&copy;
2024 SK Story</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.29.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>