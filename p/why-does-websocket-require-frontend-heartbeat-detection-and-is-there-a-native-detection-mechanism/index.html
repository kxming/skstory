<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="In the software industry, there is a famous book called ‚ÄúThe Mythical Man-Month,‚Äù which includes a discussion that there is ‚Äúno silver bullet.‚Äù"><title>Why does WebSocket require frontend heartbeat detection, and is there a native detection mechanism?</title>
<link rel=canonical href=https://www.skstory.online/p/why-does-websocket-require-frontend-heartbeat-detection-and-is-there-a-native-detection-mechanism/><link rel=stylesheet href=/scss/style.min.663803bebe609202d5b39d848f2d7c2dc8b598a2d879efa079fa88893d29c49c.css><meta property='og:title' content="Why does WebSocket require frontend heartbeat detection, and is there a native detection mechanism?"><meta property='og:description' content="In the software industry, there is a famous book called ‚ÄúThe Mythical Man-Month,‚Äù which includes a discussion that there is ‚Äúno silver bullet.‚Äù"><meta property='og:url' content='https://www.skstory.online/p/why-does-websocket-require-frontend-heartbeat-detection-and-is-there-a-native-detection-mechanism/'><meta property='og:site_name' content='SK Story'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='Code'><meta property='article:tag' content='low-code'><meta property='article:published_time' content='2024-05-20T16:22:38+08:00'><meta property='article:modified_time' content='2024-05-20T16:22:38+08:00'><meta property='og:image' content='https://cdn-images-1.medium.com/max/1600/1*K6zrMqjRYIpYEB6reDP_yA.jpeg'><meta name=twitter:site content="@https://twitter.com/ShawnKxming"><meta name=twitter:creator content="@https://twitter.com/ShawnKxming"><meta name=twitter:title content="Why does WebSocket require frontend heartbeat detection, and is there a native detection mechanism?"><meta name=twitter:description content="In the software industry, there is a famous book called ‚ÄúThe Mythical Man-Month,‚Äù which includes a discussion that there is ‚Äúno silver bullet.‚Äù"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content='https://cdn-images-1.medium.com/max/1600/1*K6zrMqjRYIpYEB6reDP_yA.jpeg'><link rel="shortcut icon" href=/favicon.ico></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu1157332405703967761.jpeg width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>üç•</span></figure><div class=site-meta><h1 class=site-name><a href=/>SK Story</a></h1><h2 class=site-description>Shawn King's Stories Website</h2></div></header><ol class=menu-social><li><a href=mailto:kxming0229@gmail.com target=_blank title=Email rel=me><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-mail"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 7a2 2 0 012-2h14a2 2 0 012 2v10a2 2 0 01-2 2H5a2 2 0 01-2-2V7z"/><path d="M3 7l9 6 9-6"/></svg></a></li><li><a href=https://www.facebook.com/p/King-Shawn-100092679065959/ target=_blank title=Facebook rel=me><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-facebook"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 10v4h3v7h4v-7h3l1-4h-4V8a1 1 0 011-1h3V3h-3a5 5 0 00-5 5v2H7"/></svg></a></li><li><a href=https://twitter.com/ShawnKxming target=_blank title=Twitter rel=me><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-x"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 4l11.733 16H20L8.267 4z"/><path d="M4 20l6.768-6.768m2.46-2.46L20 4"/></svg></a></li><li><a href=https://t.me/shawnkxming target=_blank title=Telegram rel=me><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-telegram"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M15 10l-4 4 6 6 4-16-18 7 4 2 2 6 3-4"/></svg></a></li><li><a href=https://medium.com/@kxming target=_blank title=Medium rel=me><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-medium"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 4m0 2a2 2 0 012-2h12a2 2 0 012 2v12a2 2 0 01-2 2H6a2 2 0 01-2-2z"/><path d="M8 9h1l3 3 3-3h1"/><path d="M8 15h2"/><path d="M14 15h2"/><path d="M9 9v6"/><path d="M15 9v6"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li><a href=/links/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>Links</span></a></li><li><a href=/about/><svg class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg>
<span>About</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#related-network-knowledge>Related Network Knowledge</a></li><li><a href=#mechanism-of-heartbeat-detection-in-protocols>Mechanism of Heartbeat Detection in Protocols</a></li><li><a href=#the-necessity-of-heartbeat-detection-on-the-browserside>The Necessity of Heartbeat Detection on the Browser¬†Side</a></li><li><a href=#frontend-implementation-of-heartbeat-detection>Frontend Implementation of Heartbeat Detection</a></li><li><a href=#defining-the-logic-for-sending-heartbeat-packages>Defining the Logic for Sending Heartbeat Packages:</a><ol><li><a href=#optimizing-heartbeat-detection>Optimizing Heartbeat Detection</a></li></ol></li></ol></nav></div></section></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/p/why-does-websocket-require-frontend-heartbeat-detection-and-is-there-a-native-detection-mechanism/><img src=https://cdn-images-1.medium.com/max/1600/1*K6zrMqjRYIpYEB6reDP_yA.jpeg loading=lazy alt="Featured image of post Why does WebSocket require frontend heartbeat detection, and is there a native detection mechanism?"></a></div><div class=article-details><header class=article-category><a href=/categories/code/>Code
</a><a href=/categories/low-code/>Low-Code</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/why-does-websocket-require-frontend-heartbeat-detection-and-is-there-a-native-detection-mechanism/>Why does WebSocket require frontend heartbeat detection, and is there a native detection mechanism?</a></h2><h3 class=article-subtitle>In the software industry, there is a famous book called ‚ÄúThe Mythical Man-Month,‚Äù which includes a discussion that there is ‚Äúno silver bullet.‚Äù</h3></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>May 20, 2024</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>11 minute read</time></div></footer></div></header><section class=article-content><p>In web applications, WebSocket is a very common technology. A WebSocket connection can be established simply by using the WebSocket constructor in the browser. However, when it&rsquo;s applied to specific projects, heartbeat detection is almost always implemented.</p><p>The purpose of setting up heartbeat detection is twofold: first, to confirm that both parties in the communication are still active, and second, to allow the browser side to promptly check the availability of the current network connection, ensuring the timeliness of message delivery.</p><p>You might think, is WebSocket so basic that it can&rsquo;t determine its connection status? Before understanding this further, let&rsquo;s first review some computer network knowledge.</p><h2 id=related-network-knowledge>Related Network Knowledge</h2><p>The four-layer structure of the TCP/IP protocol suite:</p><ul><li><p>Application Layer: Determines the activities of communication when providing application services to users. Protocols like HTTP, FTP, and WebSocket operate on this layer.</p></li><li><p>(Transport Control Protocol) TCP layer: Controls the data transmission between two hosts in the network by segmenting application layer data (for example, segmenting a complete HTTP message) and sending it to the application program at a specific port on the target host. It tags each data segment with a source port, target port, and sequence number after segmentation.</p></li><li><p>(Internet Protocol) IP layer: Maps IP addresses to MAC addresses of target hosts, then adds information like source IP, and target IP to the TCP packets (data fragmentation if necessary) and sends them over the network through the link layer to find the target host.</p></li><li><p>Link Layer: Sends and receives datagrams for the IP network layer, converting binary data packets to and from network electrical signals transmitted over Ethernet cables.</p></li></ul><blockquote><p>TCP is a reliable connection-oriented protocol. After establishing a handshake connection, the sender expects a confirmation message from the receiver for each TCP message sent (multiple TCP messages may be formed after application layer message segmentation) within a specified time. If there is no response, it will resend, ensuring all TCP messages reach the receiver and are reassembled in order by the receiver into the complete message needed at the application layer.</p></blockquote><blockquote><p>The WebSocket protocol supports introducing a TLS layer on top of TCP to establish encrypted communication.</p></blockquote><p><strong>The differences and similarities between WebSocket and HTTP:</strong></p><ul><li><p>Like HTTP, WebSocket is an application layer protocol that uses TCP at the transport layer and is a reliable connection. When establishing a WebSocket connection, it can use an existing HTTP GET request to handshake: the client sends information such as the WebSocket protocol version in the request headers to the server, and if the server agrees, it will respond with a status code of 101. In other words, a single HTTP request and response can smoothly switch the protocol to WebSocket.</p></li><li><p>WebSocket allows for bidirectional requests. When there is a new message, the server can actively notify the client without the client having to inquire actively. Clients can also send messages to the backend. In HTTP, requests can only be initiated by the client.</p></li><li><p>WebSocket is part of HTML5, while HTTP is the Hypertext Transfer Protocol, which predates the birth of HTML5.
At the application layer, each WebSocket message (called a data frame in WebSocket) is lighter than an HTTP message (which must include a request line, headers, and data).</p></li></ul><p>WebSocket data frames contain only fixed, lightweight header information without cookies or custom headers. After establishing communication, it is a one-to-one interaction and does not require the transmission of authentication information. However, the handshake HTTP request will automatically carry cookies.
WebSocket at the application layer will split large data into multiple frames, while HTTP does not split each message.</p><p><strong>The differences and similarities between WebSocket and WebRTC:</strong></p><p>WebRTC is a communication technology initiated by Google and implemented by a wide range of browsers. It is used to establish communication between browsers, such as video calls. Whereas WebSocket is a protocol abstraction that can be implemented as a communication technology to establish communication between browsers and servers.</p><h2 id=mechanism-of-heartbeat-detection-in-protocols>Mechanism of Heartbeat Detection in Protocols</h2><p>From the answers found online, there are approximately two ways from the perspective of protocols for WebSocket to detect if the other party is alive:</p><ol><li><p>WebSocket is merely a specification for an application layer protocol, with its transport layer being TCP, which provides a KeepAlive mechanism for long connections. This mechanism allows for the periodic sending of heartbeat messages to confirm the survival of the other party, but it&rsquo;s generally used by the server side. Since it&rsquo;s a mechanism of the TCP transport control layer, its specific implementation depends on the operating system. In other words, the connection status received at the application layer is notified by the operating system. Different operating systems schedule resources differently, such as when to send probe messages (TCP messages without valid data) to detect the survival of the other party, and how frequently, with the frequency varying under different system configurations. It might be once every two hours, or possibly shorter. Only when no response packets are received consecutively will the application layer be notified of the disconnect. This introduces uncertainty. It also means that other application layer protocols relying on this mechanism will be affected. That is to say, to utilize this process for detection, the client side will have to modify the TCP configuration of the operating system, which doesn&rsquo;t work in a browser environment.</p></li><li><p>The WebSocket protocol also has its keep-alive mechanism, but it requires implementation by both communicating parties. Data frames in WebSocket communication have a 4-bit OPCODE that marks the type of the current data frame, for example, 0x8 for the close frame, 0x9 for the ping frame, 0xA for the pong frame, 0x1 for the ordinary text data frame, <a class=link href=https://etc.www.rfc-editor.org/ target=_blank rel=noopener>etc.www.rfc-editor.org</a></p></li></ol><ul><li><p>Close data frame: When either party wants to close the channel, it sends a data frame to the other party with the OPCODE for connection closing. For example, when the WebSocket instance in the browser calls close, it sends a data frame with the OPCODE indicating a connection close to the server side, which after receiving also needs to return a closing data frame, then close the underlying TCP connection.</p></li><li><p>Ping data frame: Serves for the sender to inquire if the other party is still alive, i.e., a heartbeat check package. Currently, only the backend can control the sending of ping data frames. However, there are no corresponding APIs available on the browser side&rsquo;s WebSocket instances.</p></li><li><p>Ping data frame: When one party in the WebSocket communication receives a ping data frame sent by the other, it needs to promptly reply with a data frame of consistent content and marked as pong in the OPCODE, to tell the other party it&rsquo;s still present. However, replying to pong is an automatic behavior of the browser, meaning it varies across different browsers. Moreover, there are no APIs available in JS to control this.</p></li></ul><p>To sum up, the methods of detecting the survival of the other party are all initiated by the server performing the heartbeat detection. The browser does not provide such capabilities. To be able to detect the survival of the backend in real-time on the browser end, or in other words, to ensure the connection remains available, one must implement the heartbeat detection themselves.</p><h2 id=the-necessity-of-heartbeat-detection-on-the-browserside>The Necessity of Heartbeat Detection on the Browser¬†Side</h2><p>First, let&rsquo;s understand the circumstances under which a browser-side WebSocket will automatically close and trigger the close event:</p><ul><li><p>The WebSocket address is not available during the handshake.</p></li><li><p>Other unknown errors.</p></li><li><p>Under a normal connection, receiving a close frame from the server side will trigger the close callback.</p></li></ul><p>This means that after establishing a normal connection, if the browser side loses the network connection, or if the server closes the connection without sending a close frame‚Ää-‚Ääin short, when the connection can no longer be used and the browser has not received a close frame‚Ää-‚Ääit will maintain the connection status for a long time. In such a case, if the business code does not actively probe, it will not be able to detect this issue.
Furthermore, both parties maintaining a connection means that resources must be occupied for an extended period. For the server side, resources are extremely precious. Connections that have been inactive for a long time may be &ldquo;optimized&rdquo; and released by the server-side application layer framework.</p><h2 id=frontend-implementation-of-heartbeat-detection>Frontend Implementation of Heartbeat Detection</h2><p>Instantiate a WebSocket:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>function</span> <span class=n>connectWS</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>const</span> <span class=n>WS</span> <span class=o>=</span> <span class=n>new</span> <span class=n>WebSocket</span><span class=p>(</span><span class=s2>&#34;ws://127.0.0.1:7070/ws/?name=greaclar&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=o>//</span> <span class=n>Events</span> <span class=n>on</span> <span class=n>the</span> <span class=n>WebSocket</span> <span class=n>instance</span>
</span></span><span class=line><span class=cl>    <span class=o>//</span> <span class=n>When</span> <span class=n>the</span> <span class=n>connection</span> <span class=n>is</span> <span class=n>successfully</span> <span class=n>opened</span>
</span></span><span class=line><span class=cl>    <span class=n>WS</span><span class=o>.</span><span class=n>addEventListener</span><span class=p>(</span><span class=s1>&#39;open&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>console</span><span class=o>.</span><span class=n>log</span><span class=p>(</span><span class=s1>&#39;WebSocket connection successful&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=o>//</span> <span class=n>Listen</span> <span class=k>for</span> <span class=n>messages</span> <span class=n>pushed</span> <span class=n>from</span> <span class=n>the</span> <span class=n>backend</span>
</span></span><span class=line><span class=cl>    <span class=n>WS</span><span class=o>.</span><span class=n>addEventListener</span><span class=p>(</span><span class=s1>&#39;message&#39;</span><span class=p>,</span> <span class=p>(</span><span class=n>event</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>console</span><span class=o>.</span><span class=n>log</span><span class=p>(</span><span class=s1>&#39;WebSocket received a message&#39;</span><span class=p>,</span> <span class=n>event</span><span class=o>.</span><span class=n>data</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=o>//</span> <span class=n>Listen</span> <span class=k>for</span> <span class=n>close</span> <span class=n>messages</span> <span class=n>from</span> <span class=n>the</span> <span class=n>backend</span><span class=p>,</span> <span class=n>this</span> <span class=n>will</span> <span class=n>also</span> <span class=n>be</span> <span class=n>triggered</span> <span class=ow>in</span> <span class=k>case</span> <span class=n>of</span> <span class=n>unexpected</span> <span class=n>errors</span>
</span></span><span class=line><span class=cl>    <span class=n>WS</span><span class=o>.</span><span class=n>addEventListener</span><span class=p>(</span><span class=s1>&#39;close&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>console</span><span class=o>.</span><span class=n>log</span><span class=p>(</span><span class=s1>&#39;WebSocket connection closed&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=o>//</span> <span class=n>Listen</span> <span class=k>for</span> <span class=n>unexpected</span> <span class=n>error</span> <span class=n>messages</span> <span class=n>on</span> <span class=n>the</span> <span class=n>WebSocket</span>
</span></span><span class=line><span class=cl>    <span class=n>WS</span><span class=o>.</span><span class=n>addEventListener</span><span class=p>(</span><span class=s1>&#39;error&#39;</span><span class=p>,</span> <span class=p>(</span><span class=n>error</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>console</span><span class=o>.</span><span class=n>log</span><span class=p>(</span><span class=s1>&#39;WebSocket error&#39;</span><span class=p>,</span> <span class=n>error</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>WS</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>let</span> <span class=n>WS</span> <span class=o>=</span> <span class=n>connectWS</span><span class=p>();</span>
</span></span></code></pre></td></tr></table></div></div><p>This code snippet demonstrates the basic setup for establishing a WebSocket connection in a front-end environment. The WebSocket is instantiated using the new WebSocket constructor with a specified address, and event listeners are added to handle the connection&rsquo;s open, message, close, and error events.</p><p><strong>Instance methods needed for heartbeat detection:</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// Send a message, used for sending a heartbeat package
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>WS</span><span class=p>.</span><span class=nf>send</span><span class=p>(</span><span class=err>&#39;</span><span class=nx>hello</span><span class=err>&#39;</span><span class=p>);</span> 
</span></span><span class=line><span class=cl><span class=c1>// Close the connection, when the heartbeat package gets no response and a reconnection is needed, it&#39;s best to close it first
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>WS</span><span class=p>.</span><span class=nb>close</span><span class=p>();</span>
</span></span></code></pre></td></tr></table></div></div><p>These code lines are crucial for implementing a heartbeat mechanism in a WebSocket connection. By using WS.send(&lsquo;hello&rsquo;);, a simple message or heartbeat package is sent to check the connectivity. If there&rsquo;s no response, indicating potential issues with the connection, WS.close(); is used to properly close the connection before attempting a reconnection.</p><h2 id=defining-the-logic-for-sending-heartbeat-packages>Defining the Logic for Sending Heartbeat Packages:</h2><p><strong>Preparation</strong></p><ol><li><p>Declare a variable heartbeatStatus to track the current heartbeat check status, with three states: waiting, response received, and timeout.</p></li><li><p>Listen to the message event of the WS instance. Change heartbeatStatus to the response received upon detection.</p></li><li><p>Listen to the open event of the WS instance. Start heartbeat detection after opening.</p></li></ol><p><strong>Detection</strong></p><ol><li><p>Initiate a Timer A.</p></li><li><p>Upon Timer A‚Äôs execution, do the following: a. Change the current state heartbeatStatus to waiting; b. Send the heartbeat package; c. Start another Timer B.</p></li><li><p>After sending the heartbeat package, the backend should immediately push a heartbeat response package with the same content to the frontend, triggering the message event of the frontend WS instance, thereby changing heartbeatStatus to the response received.</p></li><li><p>When Timer B executes, check the current heartbeatStatus state:</p></li></ol><ul><li><p>If its response is received, it means the server can respond to data promptly after Timer A‚Äôs execution. Continue by restarting Timer A, and then loop continuously.</p></li><li><p>If it‚Äôs waiting, it indicates there are issues with the connection. Proceed to close or go through the detection process.</p></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>let</span> <span class=n>WS</span> <span class=o>=</span> <span class=n>connectWS</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=n>let</span> <span class=n>heartbeatStatus</span> <span class=o>=</span> <span class=s1>&#39;waiting&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>WS</span><span class=o>.</span><span class=n>addEventListener</span><span class=p>(</span><span class=s1>&#39;open&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=o>//</span> <span class=n>Start</span> <span class=n>heartbeat</span> <span class=n>detection</span> <span class=n>after</span> <span class=n>the</span> <span class=n>connection</span> <span class=n>is</span> <span class=n>successfully</span> <span class=n>established</span>
</span></span><span class=line><span class=cl>    <span class=n>startHeartbeat</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=n>WS</span><span class=o>.</span><span class=n>addEventListener</span><span class=p>(</span><span class=s1>&#39;message&#39;</span><span class=p>,</span> <span class=p>(</span><span class=n>event</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>const</span> <span class=p>{</span> <span class=n>data</span> <span class=p>}</span> <span class=o>=</span> <span class=n>event</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>console</span><span class=o>.</span><span class=n>log</span><span class=p>(</span><span class=s1>&#39;Received heartbeat response, status should now be set to received&#39;</span><span class=p>,</span> <span class=n>data</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>data</span> <span class=o>===</span> <span class=s1>&#39;&#34;heartbeat&#34;&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>heartbeatStatus</span> <span class=o>=</span> <span class=s1>&#39;received&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=n>function</span> <span class=n>startHeartbeat</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>setTimeout</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=o>//</span> <span class=n>Set</span> <span class=n>status</span> <span class=n>to</span> <span class=s1>&#39;waiting&#39;</span> <span class=k>for</span> <span class=n>a</span> <span class=n>response</span><span class=p>,</span> <span class=ow>and</span> <span class=n>send</span> <span class=n>a</span> <span class=n>heartbeat</span>
</span></span><span class=line><span class=cl>        <span class=n>heartbeatStatus</span> <span class=o>=</span> <span class=s1>&#39;waiting&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>WS</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=s1>&#39;heartbeat&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=o>//</span> <span class=n>Start</span> <span class=n>a</span> <span class=n>timer</span> <span class=n>to</span> <span class=n>check</span> <span class=k>if</span> <span class=n>the</span> <span class=n>server</span> <span class=n>has</span> <span class=n>responded</span>
</span></span><span class=line><span class=cl>        <span class=n>waitHeartbeat</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span> <span class=mi>1500</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>function</span> <span class=n>waitHeartbeat</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>setTimeout</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>console</span><span class=o>.</span><span class=n>log</span><span class=p>(</span><span class=s1>&#39;Checking if the server has responded to the heartbeat, current status:&#39;</span><span class=p>,</span> <span class=n>heartbeatStatus</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>heartbeatStatus</span> <span class=o>===</span> <span class=s1>&#39;waiting&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=o>//</span> <span class=n>Heartbeat</span> <span class=n>response</span> <span class=n>has</span> <span class=n>timed</span> <span class=n>out</span>
</span></span><span class=line><span class=cl>            <span class=n>WS</span><span class=o>.</span><span class=n>close</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=o>//</span> <span class=n>Initiate</span> <span class=n>the</span> <span class=n>next</span> <span class=nb>round</span> <span class=n>of</span> <span class=n>heartbeat</span> <span class=n>detection</span>
</span></span><span class=line><span class=cl>            <span class=n>startHeartbeat</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span> <span class=mi>1500</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=optimizing-heartbeat-detection>Optimizing Heartbeat Detection</h3><p>When the heartbeat detection fails and the close event is not triggered, there is likely a poor network connection between both parties. Immediately attempting to reconnect could consume more network resources, increasing the chances of a failed reconnection and possibly blocking other user actions.</p><p>However, it cannot be ruled out that there is indeed a problem with the connection, such as a server crash, an accidental restart, and the browser not being informed that the old connection needs to be closed.</p><p>Therefore, when a heartbeat goes unanswered, I recommend delaying for a while and then informing users that a network issue is being fixed, to prepare them psychologically. Subsequently, send one or two more heartbeat packets; if there is still no response, inform the user of disconnection and ask whether to reconnect. If normality resumes in the meantime, there is no need to reconnect, which would provide a better user experience and put less pressure on the server.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=o>//</span> <span class=n>Modifications</span> <span class=n>needed</span> <span class=ow>in</span> <span class=n>the</span> <span class=n>code</span> <span class=n>above</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>//</span> <span class=n>Add</span> <span class=n>a</span> <span class=n>variable</span> <span class=n>to</span> <span class=n>record</span> <span class=n>the</span> <span class=n>number</span> <span class=n>of</span> <span class=n>consecutive</span> <span class=n>no</span><span class=o>-</span><span class=n>responses</span>
</span></span><span class=line><span class=cl><span class=n>let</span> <span class=n>retryCount</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>WS</span><span class=o>.</span><span class=n>addEventListener</span><span class=p>(</span><span class=s1>&#39;message&#39;</span><span class=p>,</span> <span class=p>(</span><span class=n>event</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>const</span> <span class=p>{</span> <span class=n>data</span> <span class=p>}</span> <span class=o>=</span> <span class=n>event</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>console</span><span class=o>.</span><span class=n>log</span><span class=p>(</span><span class=s1>&#39;Received heartbeat response, changing status to received&#39;</span><span class=p>,</span> <span class=n>data</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>data</span> <span class=o>===</span> <span class=s1>&#39;&#34;heartbeat&#34;&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=o>//</span> <span class=n>Reset</span> <span class=n>the</span> <span class=n>count</span> <span class=n>of</span> <span class=n>consecutive</span> <span class=n>no</span><span class=o>-</span><span class=n>responses</span>
</span></span><span class=line><span class=cl>        <span class=n>retryCount</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>heartbeatStatus</span> <span class=o>=</span> <span class=s1>&#39;received&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=o>//</span> <span class=n>Add</span> <span class=n>retry</span> <span class=n>logic</span> <span class=ow>in</span> <span class=n>the</span> <span class=n>function</span> <span class=n>waiting</span> <span class=k>for</span> <span class=n>responses</span>
</span></span><span class=line><span class=cl><span class=n>function</span> <span class=n>waitHeartbeat</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>setTimeout</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=o>//</span> <span class=n>If</span> <span class=n>heartbeat</span> <span class=n>response</span> <span class=n>is</span> <span class=n>normal</span><span class=p>,</span> <span class=n>start</span> <span class=n>the</span> <span class=n>next</span> <span class=nb>round</span> <span class=n>of</span> <span class=n>heartbeat</span> <span class=n>detection</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>heartbeatStatus</span> <span class=o>===</span> <span class=s1>&#39;received&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>startHeartbeat</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=o>//</span> <span class=n>Update</span> <span class=n>the</span> <span class=n>timeout</span> <span class=n>count</span>
</span></span><span class=line><span class=cl>        <span class=n>retryCount</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=o>//</span> <span class=n>If</span> <span class=n>the</span> <span class=n>heartbeat</span> <span class=n>response</span> <span class=n>times</span> <span class=n>out</span> <span class=n>but</span> <span class=n>doesn</span><span class=s1>&#39;t consecutively exceed three times</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>retryCount</span> <span class=o>&lt;</span> <span class=mi>3</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>alert</span><span class=p>(</span><span class=s1>&#39;WS connection is abnormal, checking in progress.&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>startHeartbeat</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=o>//</span> <span class=n>If</span> <span class=n>the</span> <span class=n>timeout</span> <span class=n>count</span> <span class=n>exceeds</span> <span class=n>three</span> <span class=n>times</span>
</span></span><span class=line><span class=cl>        <span class=n>WS</span><span class=o>.</span><span class=n>close</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span> <span class=mi>1500</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div></section><footer class=article-footer><section class=article-tags><a href=/tags/code/>Code</a>
<a href=/tags/low-code/>Low-Code</a></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article class=has-image><a href=/p/why-do-many-programmers-dislike-low-code/><div class=article-image><img src=https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZwSWhTBdlE8TkdJ5G9Djpw.jpeg loading=lazy data-key data-hash=https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZwSWhTBdlE8TkdJ5G9Djpw.jpeg></div><div class=article-details><h2 class=article-title>Why do many programmers dislike low-code?</h2></div></a></article><article class=has-image><a href=/p/advanced-usage-of-reduce-you-might-not-know/><div class=article-image><img src=https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h7QTz6KqyeYG_ausGQjj5g.jpeg loading=lazy data-key data-hash=https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h7QTz6KqyeYG_ausGQjj5g.jpeg></div><div class=article-details><h2 class=article-title>Advanced Usage of Reduce You Might Not Know</h2></div></a></article><article class=has-image><a href=/p/vue3-performance-optimization-code-level-optimization/><div class=article-image><img src=https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KZsES-HkGUvu6TkmfmNMBA.png loading=lazy data-key data-hash=https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KZsES-HkGUvu6TkmfmNMBA.png></div><div class=article-details><h2 class=article-title>Vue3 Performance Optimization ‚Äî Code-Level Optimization</h2></div></a></article><article class=has-image><a href=/p/vue3-performance-optimization-bundle-optimization/><div class=article-image><img src=https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KZsES-HkGUvu6TkmfmNMBA.png loading=lazy data-key data-hash=https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KZsES-HkGUvu6TkmfmNMBA.png></div><div class=article-details><h2 class=article-title>Vue3 Performance Optimization ‚Äî Bundle Optimization</h2></div></a></article><article class=has-image><a href=/p/how-much-do-you-know-about-29-javascript-object-methods/><div class=article-image><img src=https://miro.medium.com/v2/resize:fit:1400/format:webp/1*l_w8hkehf25Nx3H_AzEVbQ.jpeg loading=lazy data-key data-hash=https://miro.medium.com/v2/resize:fit:1400/format:webp/1*l_w8hkehf25Nx3H_AzEVbQ.jpeg></div><div class=article-details><h2 class=article-title>How Much Do You Know About 29 JavaScript Object Methods?</h2></div></a></article></div></div></aside><script src=https://giscus.app/client.js data-repo=kxming/skstory data-repo-id=R_kgDOLehX4A data-category=Announcements data-category-id=DIC_kwDOLehX4M4Cd4Vx data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=light data-lang=en-us data-loading crossorigin=anonymous async></script><script>function setGiscusTheme(e){let t=document.querySelector("iframe.giscus-frame");t&&t.contentWindow.postMessage({giscus:{setConfig:{theme:e}}},"https://giscus.app")}(function(){addEventListener("message",t=>{if(event.origin!=="https://giscus.app")return;e()}),window.addEventListener("onColorSchemeChange",e);function e(){setGiscusTheme(document.documentElement.dataset.scheme==="light"?"light":"dark_dimmed")}})()</script><footer class=site-footer><section class=copyright>&copy;
2024 SK Story</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.29.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>