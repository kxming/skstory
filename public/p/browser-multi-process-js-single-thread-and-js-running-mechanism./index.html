<!DOCTYPE html>
<html lang="en-us" dir="ltr">
    <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content="Thoroughly combing through the process from multi-process browsing to JS single threading, and the running mechanism of JS.">
<title>Browser multi-process, JS single thread and JS running mechanism.</title>

<link rel='canonical' href='http://localhost:1313/p/browser-multi-process-js-single-thread-and-js-running-mechanism./'>

<link rel="stylesheet" href="/scss/style.min.d8118f156935b64eca93aca758476adca858d2c47354971654d9bd2933a0e45f.css"><meta property='og:title' content="Browser multi-process, JS single thread and JS running mechanism.">
<meta property='og:description' content="Thoroughly combing through the process from multi-process browsing to JS single threading, and the running mechanism of JS.">
<meta property='og:url' content='http://localhost:1313/p/browser-multi-process-js-single-thread-and-js-running-mechanism./'>
<meta property='og:site_name' content='SK Story'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='Javascript' /><meta property='article:published_time' content='2024-02-10T16:22:38&#43;08:00'/><meta property='article:modified_time' content='2024-02-10T16:22:38&#43;08:00'/><meta property='og:image' content='https://miro.medium.com/v2/resize:fit:1400/format:webp/1*auN6gSNpbv_7dcZ2EXBGFg.jpeg' />
<meta name="twitter:site" content="@https://twitter.com/ShawnKxming">
    <meta name="twitter:creator" content="@https://twitter.com/ShawnKxming"><meta name="twitter:title" content="Browser multi-process, JS single thread and JS running mechanism.">
<meta name="twitter:description" content="Thoroughly combing through the process from multi-process browsing to JS single threading, and the running mechanism of JS."><meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content='https://miro.medium.com/v2/resize:fit:1400/format:webp/1*auN6gSNpbv_7dcZ2EXBGFg.jpeg' />
    <link rel="shortcut icon" href="/favicon.ico" />

    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="Toggle Menu">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/avatar_hu61f49258472ba116407e56a959fa113d_189154_300x0_resize_q75_box.jpeg" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">üç•</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">SK Story</a></h1>
            <h2 class="site-description">Shawn King&#39;s Stories Website</h2>
        </div>
    </header><ol class="social-menu">
            
                <li>
                    <a 
                        href='mailto:kxming0229@gmail.com'
                        target="_blank"
                        title="Email"
                        rel="me"
                    >
                        
                        
                            <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-mail"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 7a2 2 0 0 1 2 -2h14a2 2 0 0 1 2 2v10a2 2 0 0 1 -2 2h-14a2 2 0 0 1 -2 -2v-10z" /><path d="M3 7l9 6l9 -6" /></svg>
                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://www.facebook.com/p/King-Shawn-100092679065959/'
                        target="_blank"
                        title="Facebook"
                        rel="me"
                    >
                        
                        
                            <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-brand-facebook"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 10v4h3v7h4v-7h3l1 -4h-4v-2a1 1 0 0 1 1 -1h3v-4h-3a5 5 0 0 0 -5 5v2h-3" /></svg>
                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://twitter.com/ShawnKxming'
                        target="_blank"
                        title="Twitter"
                        rel="me"
                    >
                        
                        
                            <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-brand-x"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 4l11.733 16h4.267l-11.733 -16z" /><path d="M4 20l6.768 -6.768m2.46 -2.46l6.772 -6.772" /></svg>
                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://t.me/shawnkxming'
                        target="_blank"
                        title="Telegram"
                        rel="me"
                    >
                        
                        
                            <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-brand-telegram"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M15 10l-4 4l6 6l4 -16l-18 7l4 2l2 6l3 -4" /></svg>
                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://medium.com/@kxming'
                        target="_blank"
                        title="Medium"
                        rel="me"
                    >
                        
                        
                            <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-brand-medium"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 4m0 2a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v12a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2z" /><path d="M8 9h1l3 3l3 -3h1" /><path d="M8 15l2 0" /><path d="M14 15l2 0" /><path d="M9 9l0 6" /><path d="M15 9l0 6" /></svg>
                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>Home</span>
            </a>
        </li>
        
        
        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>Archives</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>Search</span>
            </a>
        </li>
        
        
        <li >
            <a href='/links/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>Links</span>
            </a>
        </li>
        
        
        <li >
            <a href='/about/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>About</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">

                
                    <li id="dark-mode-toggle">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <span>Dark Mode</span>
                    </li>
                
            </ol>
        </li>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">Table of contents</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#distinguishing-between-process-and-thread">Distinguishing between process and thread</a></li>
    <li><a href="#browsers-are-multi-process">Browsers are multi-process</a>
      <ol>
        <li><a href="#what-processes-does-a-browser-include">What processes does a browser include?</a></li>
        <li><a href="#advantages-of-multi-process-browsers">Advantages of multi-process browsers</a></li>
        <li><a href="#the-focus-is-on-the-browser-kernel-rendering-process">The focus is on the browser kernel (rendering process)</a></li>
        <li><a href="#communication-process-between-browser-process-and-browser-kernel-renderer-process">Communication process between Browser process and Browser Kernel (Renderer process)</a></li>
      </ol>
    </li>
    <li><a href="#sorting-out-the-relationship-between-threads-inside-the-browser-kernel">Sorting out the relationship between threads inside the browser kernel</a>
      <ol>
        <li><a href="#gui-rendering-thread-and-js-engine-thread-are-mutually-exclusive">GUI Rendering Thread and JS Engine Thread are mutually exclusive</a></li>
        <li><a href="#js-blocks-page-loading">JS blocks page loading</a></li>
        <li><a href="#webworker-jss-multithreading">WebWorker, JS‚Äôs multithreading?</a></li>
        <li><a href="#webworker-and-sharedworker">WebWorker and SharedWorker</a></li>
      </ol>
    </li>
    <li><a href="#briefly-outline-the-browser-rendering-process">Briefly outline the browser rendering process</a>
      <ol>
        <li><a href="#the-sequence-of-load-event-and-domcontentloaded-event">The sequence of load event and DOMContentLoaded event</a></li>
        <li><a href="#does-loading-css-block-the-rendering-of-the-dom-tree">Does loading CSS block the rendering of the DOM tree?</a></li>
        <li><a href="#ordinary-layer-and-composite-layer">Ordinary layer and composite layer</a></li>
      </ol>
    </li>
    <li><a href="#discussing-jss-operation-mechanism-from-the-event-loop">Discussing JS‚Äôs operation mechanism from the Event Loop</a>
      <ol>
        <li><a href="#specifically-on-the-timer">Specifically on the timer.</a></li>
      </ol>
    </li>
    <li><a href="#advanced-event-loop-macrotask-vs-microtask">Advanced Event Loop: macrotask vs. microtask</a>
      <ol>
        <li><a href="#implementing-microtask-with-mutationobserver">Implementing microtask with MutationObserver</a></li>
      </ol>
    </li>
    <li><a href="#conclusion">Conclusion</a></li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="has-image main-article">
    <header class="article-header">
        <div class="article-image">
            <a href="/p/browser-multi-process-js-single-thread-and-js-running-mechanism./">
                
                    <img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*auN6gSNpbv_7dcZ2EXBGFg.jpeg" loading="lazy" alt="Featured image of post Browser multi-process, JS single thread and JS running mechanism." />
                
            </a>
        </div>
    

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/javascript/" style="background-color: #D1D419; color: #fff;">
                Javascript
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/browser-multi-process-js-single-thread-and-js-running-mechanism./">Browser multi-process, JS single thread and JS running mechanism.</a>
        </h2>
    
        
        <h3 class="article-subtitle">
            Thoroughly combing through the process from multi-process browsing to JS single threading, and the running mechanism of JS.
        </h3>
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Feb 10, 2024</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    28 minute read
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <h1 id="outline">Outline:</h1>
<ol>
<li>
<p>Distinguishing between process and thread</p>
</li>
<li>
<p>The browser is multi-process</p>
</li>
</ol>
<ul>
<li>
<p>What processes does a browser include?</p>
</li>
<li>
<p>Benefits of multi-process browsing</p>
</li>
<li>
<p>The focus is on the browser kernel (rendering process)</p>
</li>
<li>
<p>The communication process between the Browser process and the browser kernel (Renderer process)</p>
</li>
</ul>
<ol start="3">
<li>Sorting out the relationship between threads in the browser kernel</li>
</ol>
<ul>
<li>
<p>GUI rendering thread and JS engine thread are mutually exclusive</p>
</li>
<li>
<p>JS blocking page loading</p>
</li>
<li>
<p>WebWorker, is that JavaScript‚Äôs multi-threading?</p>
</li>
<li>
<p>WebWorker and SharedWorker</p>
</li>
</ul>
<ol start="4">
<li>Briefly comb through the browser rendering process</li>
</ol>
<ul>
<li>
<p>The sequence of load events and DOMContentLoaded events</p>
</li>
<li>
<p>Does the loading of CSS block the rendering of DOM tree?</p>
</li>
<li>
<p>Ordinary layers and composite layers</p>
</li>
</ul>
<ol start="5">
<li>Discussing JavaScript‚Äôs runtime mechanism from the Event Loop</li>
</ol>
<ul>
<li>
<p>Further supplement to the event loop mechanism</p>
</li>
<li>
<p>Talking separately about the timer</p>
</li>
<li>
<p>setTimeout rather than setInterval</p>
</li>
</ul>
<ol start="6">
<li>
<p>Advanced event loop: macrotask and microtask</p>
</li>
<li>
<p>Summary</p>
</li>
</ol>
<hr>
<h2 id="distinguishing-between-process-and-thread">Distinguishing between process and thread</h2>
<p>It‚Äôs quite normal for beginners to confuse threads and processes. Don‚Äôt worry about that. Let‚Äôs take a look at the following vivid metaphor:</p>
<ul>
<li>
<p>A process is like a factory, which has its independent resources</p>
</li>
<li>
<p>Factories are independent from each other</p>
</li>
<li>
<p>A thread is like a worker in the factory, multiple workers cooperate to complete tasks</p>
</li>
<li>
<p>There is one or more workers within a factory</p>
</li>
<li>
<p>Workers share space with each other</p>
</li>
</ul>
<p>Let‚Äôs further refine the concept:</p>
<ul>
<li>
<p>Factory resources -&gt; Memory allocated by the system (an independent block of memory)</p>
</li>
<li>
<p>Factories being independent -&gt; Processes being independent from each other</p>
</li>
<li>
<p>Multiple workers cooperate to complete tasks -&gt; Multiple threads within a process cooperate to complete tasks</p>
</li>
<li>
<p>There is one or more workers within a factory -&gt; A process is composed of one or more threads</p>
</li>
<li>
<p>Workers share work space -&gt; Threads within the same process share the program‚Äôs memory space (including code segments, data sets, heap, etc.)</p>
</li>
</ul>
<p>Then, let‚Äôs reinforce this:</p>
<p>On a Windows computer, you can open the task manager and see a list of background processes. Yes, that‚Äôs where you can view the processes, and you can also see the memory resources and CPU occupancy rate of each process.</p>
<p><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ayn7W3XHbx3bCwHVCf027A.png"
	
	
	
	loading="lazy"
	
	
></p>
<p>So, it should be easier to understand now: a process is the smallest unit of CPU resource allocation (the system will allocate memory to it)</p>
<p>Finally, let‚Äôs describe it again with more official terms:</p>
<p>A process is the smallest unit of CPU resource allocation (it is the smallest unit that can have resources and run separately)</p>
<p>A thread is the smallest unit of CPU scheduling (a thread is a unit of program execution based on a process, and there can be multiple threads in a process)</p>
<p><strong>Tips</strong></p>
<p>Different processes can communicate with each other, but the cost is high</p>
<p>Nowadays, the generally used terms: single-threaded and multi-threaded, both refer to single or multiple threads within one process. (So the core must belong to one process)</p>
<h2 id="browsers-are-multi-process">Browsers are multi-process</h2>
<p>After understanding the difference between process and thread, let‚Äôs get to know a bit about browsers: (first, here‚Äôs a simplified understanding)</p>
<ul>
<li>
<p>Browsers are multi-process</p>
</li>
<li>
<p>The reason why a browser can run is that the system allocates resources (CPU, memory) to its processes</p>
</li>
<li>
<p>To simplify it, every time you open a Tab, it‚Äôs like creating an independent browser process.</p>
</li>
</ul>
<p>As for the above points, please check the first image:</p>
<p><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2AC1nlb4TPJJ78wVx0qzJg.jpeg"
	
	
	
	loading="lazy"
	
	
></p>
<p>In the image, multiple tabs of the Chrome browser are opened, and you can see in Chrome‚Äôs task manager that there are multiple processes (each tab page has an independent process, along with a main process). If you are interested, you can try for yourself: if you open an extra Tab, the number of processes will normally increase by at least one.</p>
<p>Note: Browsers should also have their own optimization mechanism. Sometimes, after opening multiple tabs, you can see in the Chrome task manager that some processes have been combined (so it‚Äôs not always the case that each Tab corresponds to one process).</p>
<h3 id="what-processes-does-a-browser-include">What processes does a browser include?</h3>
<p>Knowing that the browser is multi-process, let‚Äôs see what processes it actually includes: (to simplify understanding, only the main processes are listed)</p>
<ol>
<li><strong>Browser process</strong>: The main process of the browser (responsible for coordination, control), there is only one. Its functions include:</li>
</ol>
<ul>
<li>
<p>Responsible for the display of the browser interface and interaction with the user. For example, forward, backward, etc.</p>
</li>
<li>
<p>Responsible for the management of various pages, and the creation and destruction of other processes</p>
</li>
<li>
<p>Draws the Bitmap of the Renderer process obtained from memory to the user interface</p>
</li>
<li>
<p>Manages network resources, downloads, etc.</p>
</li>
</ul>
<ol start="2">
<li>
<p><strong>Third-party plug-in process</strong>: Each type of plug-in corresponds to one process, only created when the plug-in is used</p>
</li>
<li>
<p><strong>GPU process</strong>: At most one, used for 3D rendering, etc.</p>
</li>
<li>
<p><strong>Browser rendering process (also known as the browser kernel) (Renderer process, internally multi-threaded)</strong>: By default, each Tab page is a process and they do not affect each other. Its main functions include:</p>
</li>
</ol>
<ul>
<li>Page rendering, script execution, event handling, etc.</li>
</ul>
<p>To enhance memory: <strong>opening a webpage in the browser is equivalent to starting a new process (a process with its own multiple threads)</strong></p>
<p>Of course, the browser sometimes combines multiple processes (for example, after opening multiple blank tabs, you may find that multiple blank tabs have been merged into one process), as shown in the picture.</p>
<p><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KaPdlrJqLoxPwCuMi1ZyPw.jpeg"
	
	
	
	loading="lazy"
	
	
></p>
<p>Additionally, you can verify this by yourself through Chrome‚Äôs More Tools -&gt; Task Manager.</p>
<h3 id="advantages-of-multi-process-browsers">Advantages of multi-process browsers</h3>
<p>Compared to single-process browsers, multi-process has the following advantages:</p>
<ul>
<li>
<p>Avoids a single page crash affecting the entire browser</p>
</li>
<li>
<p>Avoids a third-party plugin crash affecting the entire browser</p>
</li>
<li>
<p>Takes full advantage of multi-core</p>
</li>
<li>
<p>Isolates plugins and other processes using the sandbox model, enhancing browser stability</p>
</li>
</ul>
<p>To simplify: <strong>if the browser is single-process, then a crash on a certain Tab page would affect the entire browser, the experience would be quite poor; similarly, if it‚Äôs single-process, a plugin crash would also impact the entire browser; plus, multi-process has many other advantages‚Ä¶</strong></p>
<p>Of course, it also consumes more memory and other resources; it‚Äôs somewhat of a trade-off between space and time.</p>
<h3 id="the-focus-is-on-the-browser-kernel-rendering-process">The focus is on the browser kernel (rendering process)</h3>
<p>Let‚Äôs focus now: we can see that, although there‚Äôre many processes mentioned above, for a regular frontend operation, what‚Äôs the most important thing? The answer is the rendering process</p>
<p>You can think of it this way: the rendering of the page, the execution of JS, and the event loop, all occur within this process. Let‚Äôs focus on this process next</p>
<p>Please remember, <strong>the browser‚Äôs rendering process is multi-threaded</strong> (if you don‚Äôt understand this point, please look back at the distinction between processes and threads).</p>
<p>Finally, we get to the concept of threads üò≠, how familiar. So, let‚Äôs see what threads it includes (listing some main resident threads):</p>
<ol>
<li>GUI Rendering Thread</li>
</ol>
<ul>
<li>
<p>Responsible for rendering the browser interface, parsing HTML, CSS, building DOM tree and RenderObject tree, layout, and drawing, etc.</p>
</li>
<li>
<p>When the interface needs to be repainted (Repaint) or a reflow is triggered due to some operation, this thread will execute</p>
</li>
<li>
<p>Note that the GUI rendering thread and the JS engine thread are mutually exclusive. When the JS engine is executing, the GUI thread will be suspended (as if frozen), and GUI updates will be queued to be executed immediately when the JS engine is idle.</p>
</li>
</ul>
<ol start="2">
<li>JS Engine Thread</li>
</ol>
<ul>
<li>
<p>Also known as JS kernel, responsible for processing Javascript scripts. (e.g., V8 Engine)</p>
</li>
<li>
<p>The JS engine thread is responsible for parsing Javascript scripts and running code.</p>
</li>
<li>
<p>The JS engine is always waiting for tasks in the task queue to arrive and then processes them. No matter when, there is only one JS thread running JS programs in a Tab page (renderer process)</p>
</li>
<li>
<p>Again, note that the GUI rendering thread and the JS engine thread are mutually exclusive. Therefore, if JS takes too long to execute, it will cause the page rendering to be incoherent and block the page rendering load.</p>
</li>
</ul>
<ol start="3">
<li>Event Triggering Thread</li>
</ol>
<ul>
<li>
<p>Belongs to the browser, not the JS engine, used to control the event loop (you can think it as the JS engine is too busy and needs the browser to help by opening another thread)</p>
</li>
<li>
<p>When the JS engine executes code blocks like setTimeout (or it can come from other threads of the browser kernel, such as mouse clicks, AJAX asynchronous requests, etc.), it adds the corresponding tasks to the event thread</p>
</li>
<li>
<p>When the corresponding event meets the trigger conditions, this thread will add the event to the end of the pending queue, waiting for the JS engine to process it</p>
</li>
<li>
<p>Note that due to JS‚Äôs single thread, these events in the pending queue have to line up waiting for the JS engine to process (Only when the JS engine is idle will it execute them)</p>
</li>
</ul>
<ol start="4">
<li>Timer Trigger Thread</li>
</ol>
<ul>
<li>
<p>The legendary thread where setInterval and setTimeout are located</p>
</li>
<li>
<p>The browser timer is not counted by the JavaScript engine, (since the JavaScript engine is single-threaded, if it is in a thread-blocking state, it will affect the accurate timing)</p>
</li>
<li>
<p>Therefore, it counts and triggers timing on a separate thread (after timing is finished, it is added to the event queue, and executed only when the JS engine is idle)</p>
</li>
<li>
<p>Note, W3C stipulates in the HTML standard that any time interval less than 4ms in setTimeout is considered as 4ms.</p>
</li>
</ul>
<ol start="5">
<li>Asynchronous HTTP Request Thread</li>
</ol>
<ul>
<li>
<p>After the connection is established in XMLHttpRequest, a new thread is opened by the browser for the request</p>
</li>
<li>
<p>Once a state change is detected, if a callback function is set, the asynchronous thread generates a state change event, adds this callback to the event queue again, to be executed by the JavaScript engine.</p>
</li>
</ul>
<p>If you‚Äôre tired at this point, feel free to rest a bit, as these concepts take some time to digest. After all, the upcoming event loop mechanism is based on the event triggering thread, so if you‚Äôre just looking at a piece of information, you might have a feeling of half-understanding. It would be better to go through once to quickly settle and not forget easily. Let‚Äôs consolidate with a diagram:</p>
<p><img src="https://miro.medium.com/v2/resize:fit:1278/format:webp/1*DBLTauqwls8PdVTee5uUkQ.png"
	
	
	
	loading="lazy"
	
	
></p>
<p>Another point, why is the JS engine single-threaded? Well, this question probably doesn‚Äôt have a standard answer, such as it may simply be due to the complexity of multi-threading, like multi-thread operations generally need to be locked, so they chose single-threading in the original design‚Ä¶</p>
<h3 id="communication-process-between-browser-process-and-browser-kernel-renderer-process">Communication process between Browser process and Browser Kernel (Renderer process)</h3>
<p>If you‚Äôve read this far, you should have a good understanding of the processes and threads within the browser. Next, let‚Äôs discuss how the Browser process (control process) communicates with the Kernel. After understanding this, you can connect this part of the knowledge and form a complete concept from the beginning to the end.</p>
<p>If you open the task manager and then open a browser, you can see: two processes appear in the task manager (one is the main control process, the other is the rendering process of the opened Tab page). On this premise, look at the whole process: (highly simplified)</p>
<ol>
<li>
<p>The Browser process receives user requests, first needs to get page content (such as through network resource download), then passes this task to the Render process through the RendererHost interface.</p>
</li>
<li>
<p>The Renderer interface of the Render process receives the message, after a simple explanation, passes it to the rendering thread, and then starts to render.</p>
</li>
</ol>
<ul>
<li>
<p>The rendering thread receives the request, loads the webpage and renders it. In this process, it may require the Browser process to obtain resources and use the GPU process to assist in rendering.</p>
</li>
<li>
<p>Of course, there may be JS threads operating on the DOM (which could lead to reflow and repaint).</p>
</li>
<li>
<p>Finally, the Render process passes the result back to the Browser process.</p>
</li>
</ul>
<ol start="3">
<li>The Browser process receives the result and draws it.</li>
</ol>
<p>Let‚Äôs draw a simple diagram: (very simplified)</p>
<p><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zsMZyOJGw5IufoZb2jP5_g.png"
	
	
	
	loading="lazy"
	
	
></p>
<p>After understanding this whole process, you should have a certain understanding of how the browser works. With this basic knowledge architecture, it will be easier to fill in the content later.</p>
<p>If you want to dig deep into this part, it involves the analysis of the source code of the browser kernel, which is not within the scope of this article.</p>
<p>If you want to dig deeper into this, it is suggested to read articles analyzing the source code of the browser kernel.</p>
<h2 id="sorting-out-the-relationship-between-threads-inside-the-browser-kernel">Sorting out the relationship between threads inside the browser kernel</h2>
<p>At this point, we should have an overall concept of how the browser operates. Next, let‚Äôs simply sort out some concepts:</p>
<h3 id="gui-rendering-thread-and-js-engine-thread-are-mutually-exclusive">GUI Rendering Thread and JS Engine Thread are mutually exclusive</h3>
<p>Since JavaScript can manipulate the DOM, if these elements are modified while rendering the interface (i.e., JS thread and UI thread running at the same time), then the element data obtained by the rendering thread before and after may be inconsistent.</p>
<p>Therefore, to prevent rendering from resulting in unpredicted outcomes, the browser sets the GUI rendering thread and the JS engine as mutually exclusive. When the JS engine is executing, the GUI thread will be suspended and GUI updates will be saved in a queue and executed immediately when the JS engine thread is free.</p>
<h3 id="js-blocks-page-loading">JS blocks page loading</h3>
<p>From the above-mentioned mutual exclusion, it can be deduced that if JS takes a long time to execute, it will block the page.</p>
<p>For example, suppose the JS engine is performing a massive calculation, even when the GUI has updates, they are saved in the queue and will be executed only when the JS engine is free. As a result of the massive calculation, the JS engine is likely to remain busy for a long time, naturally causing a feeling of a very laggy experience.</p>
<p>Therefore, it‚Äôs advisable to avoid excessive JS execution times as much as possible, as this will cause the page rendering to be discontinuous, leading to a feeling of page rendering loading being blocked.</p>
<h3 id="webworker-jss-multithreading">WebWorker, JS‚Äôs multithreading?</h3>
<p>We mentioned earlier that the JS engine is single-threaded, and that if JS executes for too long it can block a page. So, is JS really powerless when it comes to CPU-intensive calculations?</p>
<p>Therefore, Web Worker was supported later in HTML5.</p>
<p>The official MDN explanation is:</p>
<blockquote>
<p>Web Workers provide a simple means for web content to run scripts in background threads. The thread can carry out tasks without interfering with the user interface</p>
<p>A worker is an object created using a constructor (e.g., Worker()) that runs a named JavaScript file</p>
<p>This file contains the code that will run in the worker thread; workers run in another global context that is different from the current ‚Äòwindow‚Äô</p>
<p>Therefore, using the window shortcut to get to the current global scope (rather than self) within a Worker will return an error</p>
</blockquote>
<p>Understanding it in this way:</p>
<ul>
<li>
<p>When creating a Worker, the JS engine requests the browser to open a sub-thread (the sub-thread is opened by the browser, completely controlled by the main thread, and can‚Äôt operate on the DOM)</p>
</li>
<li>
<p>The JS engine thread and the worker thread communicate through a specific way (postMessage API, it needs to serialize objects to interact with specific data)</p>
</li>
</ul>
<p>So, if there is a very time-consuming job, start a Worker thread separately, no matter what happens in it, it will not affect the main thread of the JS engine, only need to communicate the result to the main thread after the calculation is done, perfect!</p>
<p>And note that the <strong>JS engine is still single-threaded</strong>, this fact has not changed, Worker can be considered as an ‚Äúoutside help‚Äù provided by the browser for the JS engine, specifically used to solve those heavy computing problems.</p>
<p>Further explanation about Worker is not the scope of this article, so we won‚Äôt elaborate further.</p>
<h3 id="webworker-and-sharedworker">WebWorker and SharedWorker</h3>
<p>Since we‚Äôre here, let‚Äôs also mention SharedWorker (to avoid confusion with WebWorker in the future)</p>
<p>WebWorker belongs only to some page, it won‚Äôt be shared with other pages‚Äô Render process (browser kernel process)</p>
<ul>
<li>
<p>So Chrome creates a new thread in the Render process (each Tab page is a render process) to run the JavaScript program in the Worker.
SharedWorker is shared by all pages in the browser and can‚Äôt be implemented in the same way as Worker, because it doesn‚Äôt belong to some Render process, it can be shared by multiple Render processes</p>
</li>
<li>
<p>So Chrome browser creates a separate process for SharedWorker to run the JavaScript program, in the browser each same JavaScript only has one SharedWorker process, no matter how many times it is created.
At this point, it should be easy to understand, essentially it‚Äôs the difference between processes and threads. SharedWorker is managed by a separate process, WebWorker is just a thread under the render process.</p>
</li>
</ul>
<h2 id="briefly-outline-the-browser-rendering-process">Briefly outline the browser rendering process</h2>
<p>Originally, the plan was to start discussing the JS operation mechanism directly, but after some consideration, since we‚Äôve been talking about browsers above, jumping directly to JS might seem abrupt. Therefore, I‚Äôll supplement the rendering process of the browser (simple version) in between.</p>
<p>To simplify understanding, the early work is directly omitted: (If you want to elaborate or need more details, they could make up another lengthy article)</p>
<ul>
<li>
<p>Enter the URL in the browser, the browser‚Äôs main process takes over, opens a download thread, then makes an HTTP request (omitting operations like DNS query, IP addressing, etc.), waits for the response, gets the content, then passes the content to the Renderer process through the RendererHost interface.</p>
</li>
<li>
<p>Browser rendering process begins</p>
</li>
</ul>
<p>After the browser‚Äôs core gets the content, the rendering can be divided into the following steps:</p>
<ul>
<li>
<p>Parsing HTML to build the DOM tree</p>
</li>
<li>
<p>Parsing CSS to build the render tree (Parse the CSS code into a tree-like data structure, then merge it with DOM to form a render tree)</p>
</li>
<li>
<p>Layout/render tree (Layout/reflow), responsible for the calculation of element size and position</p>
</li>
<li>
<p>Draw/render tree (paint), draw the pixel information of the page</p>
</li>
<li>
<p>The browser will send the information of each layer to the GPU, and the GPU will composite the layers and display them on the screen.</p>
</li>
</ul>
<p>All detailed steps have been omitted. After the rendering is completed, it‚Äôs the load event, and then to your own JS logic processing.</p>
<p>Since we‚Äôve omitted some detailed steps, we might as well point out some details that might need to be paid attention to.</p>
<p>Here‚Äôs a reference to a diagram of repainting:</p>
<p><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K23c3bPbM026R_qlnLMBZg.png"
	
	
	
	loading="lazy"
	
	
></p>
<h3 id="the-sequence-of-load-event-and-domcontentloaded-event">The sequence of load event and DOMContentLoaded event</h3>
<p>As mentioned above, the load event will be triggered after the rendering is complete. So, can you distinguish the sequence of the load event and the DOMContentLoaded event?</p>
<p>It‚Äôs easy, know their definitions:</p>
<ul>
<li>
<p>When the DOMContentLoaded event is triggered, only when the DOM is loaded, it does not include stylesheets, images. (For example, if scripts are loaded asynchronously, they might not necessarily be completed)</p>
</li>
<li>
<p>When the onload event is triggered, all DOMs, stylesheets, scripts, and images have been loaded on the page. (Rendering is complete)</p>
</li>
</ul>
<p>So, the order is: DOMContentLoaded -&gt; load</p>
<h3 id="does-loading-css-block-the-rendering-of-the-dom-tree">Does loading CSS block the rendering of the DOM tree?</h3>
<p>We‚Äôre talking about the situation of importing CSS in the header.</p>
<p>First of all, we all know that CSS is downloaded asynchronously by a separate download thread.</p>
<p>Then, let‚Äôs talk about a few phenomena:</p>
<ul>
<li>
<p>CSS loading does not block DOM tree parsing (DOM continues to be built while loading asynchronously)</p>
</li>
<li>
<p>But it does block render tree rendering (Rendering needs to wait until CSS is loaded, because render tree needs CSS information)</p>
</li>
</ul>
<p>This may also be a kind of optimization mechanism of the browser.</p>
<p>Because you might modify the style of the following DOM nodes while loading CSS, if CSS loading does not block render tree rendering, then when CSS is loaded, the render tree may need to be redrawn or reflowed again, which causes some unnecessary waste. So just first parse the structure of the DOM tree, finish the work that can be done, and then wait until your CSS is loaded, then render the render tree according to the final style. This approach could indeed be better performing.</p>
<h3 id="ordinary-layer-and-composite-layer">Ordinary layer and composite layer</h3>
<p>The concept of composite was mentioned in the rendering steps.</p>
<p>This can be simply understood as such: the layers rendered by the browser generally include two major types: ordinary layers and composite layers.</p>
<p>Firstly, the normal document flow can be understood as one composite layer (here called the default composite layer, regardless of how many elements are added, they are actually in the same composite layer)</p>
<p>Second, for absolute layout (same for fixed), although it can escape the normal document flow, it still belongs to the default composite layer.</p>
<p>Then, a new composite layer can be declared through hardware acceleration, which will independently allocate resources (of course, it will also get out of the normal document flow. Hence, no matter how the composite layer changes, it will not affect the reflow and repaint in the default composite layer)</p>
<p>This can be simply understood as such: in the GPU, each composite layer is drawn independently, so they do not affect each other. That‚Äôs also why hardware acceleration is so effective in certain scenarios.</p>
<p>This can be seen in Chrome source code debug -&gt; More Tools -&gt; Rendering -&gt; Layer borders, where the yellow ones represent composite layer information.</p>
<p><strong>How to become a composite layer (hardware acceleration)</strong></p>
<p>To turn an element into a composite layer is the so-called hardware acceleration technique.</p>
<ul>
<li>
<p>The most common way is: translate3d, translateZ</p>
</li>
<li>
<p>opacity attribute/transition animation (a composite layer will be created only in the process of animation execution; before the animation starts or after it ends, the element will return to its previous state)</p>
</li>
<li>
<p>will-change attribute (this one is quite rare), usually used with opacity and translate (and, after testing, except for the properties that can trigger hardware acceleration as mentioned above, other properties will not become composite layers), its function is to tell the browser in advance that changes will be made, so the browser will start to do some optimization work (be sure to release this once you finish using it)</p>
</li>
<li>
<p>Elements such as <code>&lt;video&gt; &lt;iframe&gt; &lt;canvas&gt; &lt;webgl&gt;</code></p>
</li>
<li>
<p>Others, like the flash plugin in the past.</p>
</li>
</ul>
<p><strong>Difference between absolute and hardware acceleration</strong></p>
<p>As can be seen, although absolute can escape the normal document flow, it cannot escape the default composite layer. So, even if the information in absolute changes and does not change the render tree in the normal document flow, during the final rendering by the browser, the entire composite layer is rendered. So, any changes in the information in absolute will still affect the rendering of the entire composite layer. (The browser will repaint it, large changes in rendering information brought by absolute with a lot of content in the composite layer can cause serious resource consumption)</p>
<p>And hardware acceleration just directly refers to another composite layer (‚Äústart from scratch‚Äù), so its information changes will not affect the default composite layer (of course, it will definitely affect the composite layer it belongs to internally), it only triggers the final composition (outputting the view)</p>
<p><strong>What‚Äôs the role of a composite layer?</strong></p>
<p>Generally, an element will become a composite layer after hardware acceleration is enabled, which can be independent of the normal document flow, and changes can avoid repainting the entire page, thereby improving performance.</p>
<p>But try not to use a large number of composite layers, otherwise, due to excessive resource consumption, the page may become even more laggy.</p>
<p>When using hardware acceleration, please use an index</p>
<p>When using hardware acceleration, try to use an index as much as possible to prevent the browser from defaulting to create composite layers for subsequent elements.</p>
<p>The specific principle is this: in webkit CSS3, if this element has added hardware acceleration and has a relatively low index level, then other elements after this element (those with a higher or same level, and with the same relative or absolute properties), will default to composite layer rendering. If not handled properly, this can greatly impact performance.</p>
<p>To put it simply, it‚Äôs actually an implicit composite concept: if a is a composite layer and b is on top of a, then b will also be implicitly transformed into a composite layer, which needs to be especially noted.</p>
<h2 id="discussing-jss-operation-mechanism-from-the-event-loop">Discussing JS‚Äôs operation mechanism from the Event Loop</h2>
<p>By now, it‚Äôs about things happening after the initial rendering of the browser page, and some analysis of the JS engine‚Äôs operation mechanism.</p>
<p>Keep in mind, I won‚Äôt be discussing execution contexts, VoiceOver (VO), scope chains, etc., (those could totally make up another article), here I‚Äôm mainly talking about how JS code is executed in conjunction with the Event Loop.</p>
<p>A prerequisite for understanding this part is knowing that the JS engine is single-threaded, and here I‚Äôll use a few concepts from the text above: (If you don‚Äôt understand them quite well, you can review them)</p>
<ul>
<li>
<p>JS engine thread</p>
</li>
<li>
<p>Event trigger thread</p>
</li>
<li>
<p>Timer trigger thread</p>
</li>
</ul>
<p>And then understand another concept:</p>
<ul>
<li>
<p>JS is divided into synchronous tasks and asynchronous tasks</p>
</li>
<li>
<p>Synchronous tasks are executed on the main thread and form an execution stack</p>
</li>
<li>
<p>Outside the main thread, an event trigger thread manages a task queue, and as long as the asynchronous task has a running result, an event will be placed in the task queue.</p>
</li>
<li>
<p>Once all synchronous tasks in the execution stack are completed (the JS engine is idle at this time), the system will read the task queue and add any runnable asynchronous tasks to the execution stack and start executing them.</p>
</li>
</ul>
<p>Refer to the following diagram:</p>
<p><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nH7Uvs0xWNBOUYgVRsmDqw.png"
	
	
	
	loading="lazy"
	
	
></p>
<p>By this point, you should understand: Why can‚Äôt the events pushed by setTimeout always execute on time? Because maybe when it pushed into the event list, the main thread wasn‚Äôt idle, and it was executing other code, so naturally there could be discrepancies.</p>
<p>Further supplement to the event loop mechanism</p>
<p>Here, I‚Äôm directly referencing a diagram to assist your understanding:</p>
<p><img src="https://miro.medium.com/v2/resize:fit:1202/format:webp/1*hYwK2TD-BkQHC7Oij0RuLg.png"
	
	
	
	loading="lazy"
	
	
></p>
<p>The diagram roughly describes:</p>
<ul>
<li>
<p>When the main thread runs, it generates an execution stack. When the code in the stack calls certain APIs, they add various events to the event queue (triggered when conditions are met, such as when an AJAX request is completed)</p>
</li>
<li>
<p>Once the code in the stack finish executing, it will read the events in the event queue and execute those callbacks</p>
</li>
<li>
<p>This is a loop process.</p>
</li>
<li>
<p>Note, you always have to wait for the code in the stack to finish executing before you read the events in the event queue.</p>
</li>
</ul>
<h3 id="specifically-on-the-timer">Specifically on the timer.</h3>
<p>The core of the aforementioned event loop mechanism is: JS engine thread and event trigger thread</p>
<p>But in regards to the event, there are some hidden details, for instance, after calling setTimeout, how does it wait for a specific time before adding it to the event queue?</p>
<p>Is it detected by the JS engine? Of course not. It is controlled by the timer thread (because the JS engine itself is too busy to multitask).</p>
<p>Why do we need a separate timer thread? Because the JavaScript engine is single-threaded, if it‚Äôs in a blocked thread state, it will affect the accuracy of the timing, so it‚Äôs necessary to start a separate thread for timing.</p>
<p>When do we use the timer thread? When using setTimeout or setInterval, it relies on the timer thread for timing. Once the timing is completed, it will push a specific event into the event queue.</p>
<p>For example:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">setTimeout(function(){
</span></span><span class="line"><span class="cl">    console.log(&#39;hello!&#39;);
</span></span><span class="line"><span class="cl">}, 1000);
</span></span></code></pre></td></tr></table>
</div>
</div><p>The function of this code is to start the timing for 1000 milliseconds (timed by the timer thread), then pushes the callback function into the event queue, waiting for the main thread to execute.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">setTimeout(function(){
</span></span><span class="line"><span class="cl">    console.log(&#39;hello!&#39;);
</span></span><span class="line"><span class="cl">}, 0);
</span></span><span class="line"><span class="cl">console.log(&#39;begin&#39;);
</span></span></code></pre></td></tr></table>
</div>
</div><p>The function of this code is to push the callback function into the event queue at the earliest possible time, waiting for the main thread to execute.</p>
<p>Note:</p>
<ul>
<li>
<p>The execution result is: ‚Äòbegin‚Äô first, and then ‚Äòhello‚Äô!</p>
</li>
<li>
<p>Although the original intention of the code is to push it into the event queue after 0 milliseconds, the W3C stipulates in the HTML standard that a time interval less than 4ms in setTimeout should be counted as 4ms. (However, there are different opinions, stating that different browsers have different minimum time settings)</p>
</li>
<li>
<p>Even if it doesn‚Äôt wait for 4ms, even if it‚Äôs assumed to push into the event queue after 0 milliseconds, it will execute ‚Äòbegin‚Äô first (because only when the executable stack is empty, it will actively read the event queue)</p>
</li>
</ul>
<p><strong>setTimeout instead of setInterval</strong></p>
<p>Simulating regular timing with setTimeout and using setInterval directly are different.</p>
<p>This is because each time setTimeout times out, it will be executed, and then it will be executed for a while before continuing setTimeout, causing an error in the middle (the amount of error is related to the execution time of the code).</p>
<p>While setInterval is to push an event at precise intervals each time (However, the actual execution time of the event may not be accurate, and it may even happen that the next event comes before the current event finishes execution)</p>
<p>Moreover, setInterval has some quite fatal issues:</p>
<ul>
<li>
<p>Cumulative effect (as mentioned above), if the setInterval code is not finished executing before it is added to the queue by setInterval again, it will cause the timer code to run continuously several times, without intervals. Even if it is executed normally at intervals, the execution time of multiple setInterval codes may be less than expected (because code execution needs some time)</p>
</li>
<li>
<p>Moreover, when the browser is minimized, etc., setInterval does not stop the execution of the program, it will put the callback function of setInterval in the queue, and when the browser window is opened again, it executes all at once.</p>
</li>
</ul>
<p>So, considering so many problems, the currently generally accepted best solution is: use setTimeout to simulate setInterval, or directly use requestAnimationFrame for special occasions.</p>
<p>Supplement: It‚Äôs mentioned in ‚ÄòProfessional JavaScript for Web Developers‚Äô that the JS engine will optimize setInterval, if there is a callback from setInterval in the current event queue, it won‚Äôt be added again. However, there are still a lot of issues.</p>
<h2 id="advanced-event-loop-macrotask-vs-microtask">Advanced Event Loop: macrotask vs. microtask</h2>
<p>First, let‚Äôs look at this code snippet:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">console.log(&#39;script start&#39;);
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">setTimeout(function() {
</span></span><span class="line"><span class="cl">    console.log(&#39;setTimeout&#39;);
</span></span><span class="line"><span class="cl">}, 0);
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Promise.resolve().then(function() {
</span></span><span class="line"><span class="cl">    console.log(&#39;promise1&#39;);
</span></span><span class="line"><span class="cl">}).then(function() {
</span></span><span class="line"><span class="cl">    console.log(&#39;promise2&#39;);
</span></span><span class="line"><span class="cl">});
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">console.log(&#39;script end&#39;);
</span></span></code></pre></td></tr></table>
</div>
</div><p>The correct execution order is as follows:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">script start
</span></span><span class="line"><span class="cl">script end
</span></span><span class="line"><span class="cl">promise1
</span></span><span class="line"><span class="cl">promise2
</span></span><span class="line"><span class="cl">setTimeout
</span></span></code></pre></td></tr></table>
</div>
</div><p>Why? Because a new concept is introduced within Promise: microtask</p>
<p>Or further, JS divides into two types of tasks: macrotask and microtask, in ECMAScript, microtask is called jobs, and a macrotask can be called task</p>
<p>Their definition? Difference? Simply understand as follows:</p>
<ol>
<li><strong>macrotask</strong> (also known as macro-task), each code block executed in the execution stack can be seen as a macrotask (including each event callback retrieved from the event queue and placed into the execution stack for execution)</li>
</ol>
<ul>
<li>
<p>Each task will execute the current task from start to finish without executing others</p>
</li>
<li>
<p>In order for the JS internal task and DOM task to execute sequentially, the browser will re-render the page after one task has finished and before the next task begins (task-&gt;rendering-&gt;task-&gt;‚Ä¶)</p>
</li>
</ul>
<ol start="2">
<li><strong>microtask</strong> (also known as micro-task), tasks that are executed immediately after the current task finishes</li>
</ol>
<ul>
<li>
<p>That is to say, after the current task, before the next task, and before rendering</p>
</li>
<li>
<p>So its response speed is faster than setTimeout (setTimeout is a task) as it does not need to wait for rendering</p>
</li>
<li>
<p>That is, after a macrotask is executed, it will complete all the microtasks that were generated during its execution (before rendering)</p>
</li>
</ul>
<p>What scenarios will form a macrotask and a microtask?</p>
<ul>
<li>
<p>macrotask: main code block, setTimeout, setInterval, etc. (you can see, each event in the event queue is a macrotask)</p>
</li>
<li>
<p>microtask: Promise, process.nextTick, etc.</p>
</li>
</ul>
<p><strong>Supplement: In the node environment, process.nextTick has higher priority than Promise</strong>, which can be simply understood as: after the macro task ends, it first executes the nextTickQueue part in the microtask queue, then it executes the Promise part in the microtask</p>
<p>Let‚Äôs understand this from the perspective of threads:</p>
<ul>
<li>
<p>Events within macrotask are all placed in one event queue, maintained by the event trigger thread</p>
</li>
<li>
<p>All microtasks in microtask are added to the microtask queue (Job Queues), waiting for the current macrotask to finish, this queue is maintained by the JS engine thread (it‚Äôs concluded from self-understanding and speculation, as its executed seamlessly under the main thread)</p>
</li>
</ul>
<p>So, here‚Äôs the summary of the running mechanism:</p>
<ul>
<li>
<p>xecute a macrotask (get from the event queue if there is none in the stack)</p>
</li>
<li>
<p>If a microtask is encountered during the execution, add it to the microtask queue</p>
</li>
<li>
<p>After the macro-task finishes, immediately execute all microtasks in the current microtask queue (one by one)</p>
</li>
<li>
<p>After the current macrotask finishes, start checking for rendering, then the GUI thread takes over rendering</p>
</li>
<li>
<p>After rendering, the JS thread takes over again, starting the next macrotask (getting from the event queue)</p>
</li>
</ul>
<p>As illustrated:</p>
<p><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AOdhV7sMnCU6zDenHUaLxg.png"
	
	
	
	loading="lazy"
	
	
></p>
<p>Also, please note the difference between Promise‚Äôs polyfill and the official version:</p>
<ul>
<li>
<p>In the official version, it is a standard microtask form</p>
</li>
<li>
<p>polyfill, usually simulated by setTimeout, so it is macrotask form</p>
</li>
</ul>
<p>Please particularly note these two differences</p>
<p>Note, some browsers have different results (because they may treat microtask as macrotask), but for simplicity, some non-standard browser scenarios are not described here (but remember, some browsers may not be standard)</p>
<h3 id="implementing-microtask-with-mutationobserver">Implementing microtask with MutationObserver</h3>
<p>MutationObserver can be used to implement microtasks (it‚Äôs considered a microtask with lower priority than Promise, it‚Äôs generally used when Promise is not supported)</p>
<p>It‚Äôs a new feature in HTML5, its function is: to monitor a DOM change. When any change occurs in the DOM object tree, Mutation Observer will be notified.</p>
<p>For instance, in the previous Vue source code, it was used to simulate nextTick. The specific principle is to create a TextNode and monitor its changes. Then, when nextTick is performed, change the text content of this node. As shown:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="k">var</span> <span class="n">counter</span> <span class="o">=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="k">var</span> <span class="n">observer</span> <span class="o">=</span> <span class="n">new</span> <span class="n">MutationObserver</span><span class="p">(</span><span class="n">nextTickHandler</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">var</span> <span class="n">textNode</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">createTextNode</span><span class="p">(</span><span class="ne">String</span><span class="p">(</span><span class="n">counter</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">observer</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="n">textNode</span><span class="p">,</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">characterData</span><span class="p">:</span> <span class="bp">true</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="n">timerFunc</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">counter</span> <span class="o">=</span> <span class="p">(</span><span class="n">counter</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span>
</span></span><span class="line"><span class="cl">    <span class="n">textNode</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="ne">String</span><span class="p">(</span><span class="n">counter</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>However, later versions of Vue (2.5+) removed the MutationObserver way from nextTick‚Äôs implementation (presumably due to compatibility reasons), and instead used MessageChannel (of course, the default is still Promise, with compatibility as backup).</p>
<p>MessageChannel is a macrotask, and its priority is: MessageChannel -&gt; setTimeout, so the internal nextTick of Vue (2.5+) is different from the implementation of 2.4 and before. That‚Äôs something you should be aware of.</p>
<h2 id="conclusion">Conclusion</h2>
<p>Having read this far, I‚Äôm not sure if you have a better understanding of JS‚Äôs operating mechanism, but going through it all from start to finish, rather than just a fragmentary piece of knowledge, should definitely clear things up?</p>
<p>At the same time, it‚Äôs also worth noting that JS is not as simple as you might think it is, front-end knowledge is infinite, with endless concepts, a ton of easily forgotten knowledge points, all kinds of frameworks, and the underlying principles that can be endlessly delved into. Then, you‚Äôll find out that what you know is too little‚Ä¶</p>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/javascript/">Javascript</a>
        
    </section>


    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    </footer>


    
</article>

    

    

<aside class="related-content--wrapper">
    <h2 class="section-title">Related content</h2>
    <div class="related-content">
        <div class="flex article-list--tile">
            
                
<article class="has-image">
    <a href="/p/understanding-definemodel-in-vue3/">
        
        
            <div class="article-image">
                
                    <img src="https://miro.medium.com/v2/resize:fit:1274/format:webp/1*XNUMO2PM_SwVgmdGARQtCQ.png" loading="lazy" data-key="" data-hash="https://miro.medium.com/v2/resize:fit:1274/format:webp/1*XNUMO2PM_SwVgmdGARQtCQ.png"/>
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">Understanding defineModel in Vue3</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/understanding-fragment-in-vue3/">
        
        
            <div class="article-image">
                
                    <img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YMMs8s-H6fct1k8DJ1vLRw.png" loading="lazy" data-key="" data-hash="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YMMs8s-H6fct1k8DJ1vLRw.png"/>
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">Understanding Fragment in Vue3</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/understanding-teleport-in-vue3/">
        
        
            <div class="article-image">
                
                    <img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GgMh0JyvKDIrI7ahnm8uiQ.jpeg" loading="lazy" data-key="" data-hash="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GgMh0JyvKDIrI7ahnm8uiQ.jpeg"/>
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">Understanding Teleport in Vue3</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/understanding-async-components-in-vue3/">
        
        
            <div class="article-image">
                
                    <img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SoXuFiQrG7Mex4MN6hmO3g.jpeg" loading="lazy" data-key="" data-hash="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SoXuFiQrG7Mex4MN6hmO3g.jpeg"/>
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">Understanding Async Components in Vue3</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/understanding-watch-and-watcheffect-in-vue3/">
        
        
            <div class="article-image">
                
                    <img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v6hSD9YqWXc8J6oR-4kQsQ.png" loading="lazy" data-key="" data-hash="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v6hSD9YqWXc8J6oR-4kQsQ.png"/>
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">Understanding watch and watchEffect in Vue3</h2>
        </div>
    </a>
</article>

            
        </div>
    </div>
</aside>

     
    
        
    <script
    src="https://giscus.app/client.js"
    data-repo="kxming/skstory"
    data-repo-id="R_kgDOLehX4A"
    data-category="Announcements"
    data-category-id="DIC_kwDOLehX4M4Cd4Vx"
    data-mapping="pathname"
    data-strict="0"
    data-reactions-enabled="1"
    data-emit-metadata="0"
    data-input-position="top"
    data-theme="light"
    data-lang="en"
    crossorigin="anonymous"
    async
></script>
<script>
    function setGiscusTheme(theme) {
        let giscus = document.querySelector("iframe.giscus-frame");
        if (giscus) {
            giscus.contentWindow.postMessage(
                {
                    giscus: {
                        setConfig: {
                            theme: theme,
                        },
                    },
                },
                "https://giscus.app"
            );
        }
    }

    (function () {
        addEventListener("message", (e) => {
            if (event.origin !== "https://giscus.app") return;
            handler();
        });
        window.addEventListener("onColorSchemeChange", handler);

        function handler() {
            if (document.documentElement.dataset.scheme === "light") {
                setGiscusTheme('light');
            } else {
                setGiscusTheme('dark_dimmed');
            }
        }
    })();
</script>

    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
        2024 SK Story
    </section>
    
    <section class="powerby">
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        Theme <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.24.1">Stack</a></b> designed by <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a>
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
